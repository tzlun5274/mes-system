<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>測試 SMT 工單數量載入</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background-color: #f0f0f0; border-radius: 3px; }
        button { padding: 10px 15px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>測試 SMT 工單數量載入功能</h1>
    
    <div class="test-section">
        <h3>測試工單數量載入</h3>
        <label for="workorder_id">工單 ID:</label>
        <input type="number" id="workorder_id" value="3249" placeholder="輸入工單 ID">
        <button onclick="testLoadWorkorderQuantity()">載入工單數量</button>
        <div class="result" id="result1">結果將顯示在這裡...</div>
    </div>
    
    <div class="test-section">
        <h3>測試工單選擇事件</h3>
        <select id="workorder_select">
            <option value="">請選擇工單...</option>
            <option value="3249">331-25725001 - PFP-CCTOTCTS17-500 (48件)</option>
            <option value="3248">331-25723001 - PFP-CCTOCNK3S2PM3-500 (1264件)</option>
        </select>
        <div class="result" id="result2">工單數量: <span id="workorder_quantity_display">未選擇</span></div>
    </div>

    <script>
        // 模擬 loadWorkorderQuantity 函數
        function loadWorkorderQuantity(workorderId) {
            console.log('開始載入工單數量，工單ID:', workorderId);
            
            fetch(`/workorder/api/get_workorder_details/?workorder_id=${workorderId}`, {
                method: 'GET',
                headers: {
                    'X-CSRFToken': 'test-csrf-token'
                }
            })
            .then(response => {
                console.log('API 回應狀態:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('API 回應數據:', data);
                if (data.status === 'success') {
                    const quantity = data.workorder.quantity || 0;
                    console.log('設置工單數量:', quantity);
                    document.getElementById('workorder_quantity_display').textContent = quantity;
                    return quantity;
                } else {
                    console.error('載入工單數量失敗：', data.message);
                    document.getElementById('workorder_quantity_display').textContent = '載入失敗';
                    return null;
                }
            })
            .catch(error => {
                console.error('載入工單數量時發生錯誤:', error);
                document.getElementById('workorder_quantity_display').textContent = '錯誤';
                return null;
            });
        }

        // 測試函數
        function testLoadWorkorderQuantity() {
            const workorderId = document.getElementById('workorder_id').value;
            const resultDiv = document.getElementById('result1');
            
            if (!workorderId) {
                resultDiv.innerHTML = '請輸入工單 ID';
                return;
            }
            
            resultDiv.innerHTML = '載入中...';
            
            loadWorkorderQuantity(workorderId).then(quantity => {
                if (quantity !== null) {
                    resultDiv.innerHTML = `成功載入工單數量: ${quantity}`;
                } else {
                    resultDiv.innerHTML = '載入失敗';
                }
            });
        }

        // 工單選擇事件
        document.getElementById('workorder_select').addEventListener('change', function() {
            console.log('工單選擇變更事件觸發');
            const selectedOption = this.options[this.selectedIndex];
            console.log('選中的選項:', selectedOption);
            
            if (selectedOption && selectedOption.value) {
                console.log('選中工單ID:', selectedOption.value);
                loadWorkorderQuantity(selectedOption.value);
            } else {
                console.log('沒有選中工單，清空相關欄位');
                document.getElementById('workorder_quantity_display').textContent = '未選擇';
            }
        });

        console.log('測試頁面已載入');
    </script>
</body>
</html> 