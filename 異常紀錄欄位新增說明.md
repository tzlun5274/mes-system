# 異常紀錄欄位新增說明

## 📋 修改概述

根據需求，在作業員和SMT的匯出匯入功能中，於備註欄位右邊增加了一個「異常紀錄」欄位。異常紀錄欄位有紀錄的才是異常報工，備註欄位有紀錄的是正常報工。

## 🔧 修改內容

### 1. SMT補登報工功能

#### 匯出功能 (`smt_supplement_export`)
- **檔案位置**: `workorder/views.py` 第4746行
- **修改內容**: 
  - 標題行增加「異常紀錄」欄位
  - 資料行增加異常紀錄欄位的顯示 (`report.abnormal_notes`)

#### 範本下載功能 (`smt_supplement_template`)
- **檔案位置**: `workorder/views.py` 第4865行
- **修改內容**:
  - Excel和CSV範本都增加「異常紀錄」欄位
  - 範例資料中增加異常紀錄的範例（如「設備故障」）

#### 匯入處理功能 (`process_smt_supplement_row`)
- **檔案位置**: `workorder/views.py` 第5216行
- **修改內容**:
  - 函數參數增加 `abnormal_record` 參數
  - 創建記錄時增加 `abnormal_notes=abnormal_record or ''`

#### 批量匯入功能 (`smt_supplement_batch_create`)
- **檔案位置**: `workorder/views.py` 第5393行
- **修改內容**:
  - Excel讀取時增加第12欄位的異常紀錄讀取
  - CSV讀取時增加異常紀錄欄位的處理
  - 必要欄位檢查增加「異常紀錄」

### 2. 作業員補登報工功能

#### 匯出功能 (`operator_supplement_export`)
- **檔案位置**: `workorder/views.py` 第6821行
- **修改內容**:
  - 標題行增加「異常紀錄」欄位
  - 資料行增加異常紀錄欄位的顯示 (`report.abnormal_notes`)

#### 範本下載功能 (`operator_supplement_template`)
- **檔案位置**: `workorder/views.py` 第6915行
- **修改內容**:
  - Excel和CSV範本都增加「異常紀錄」欄位
  - 範例資料中增加異常紀錄的範例（如「設備故障」）

#### 匯入處理功能 (`process_operator_supplement_row`)
- **檔案位置**: `workorder/views.py` 第7021行
- **修改內容**:
  - 函數參數增加 `abnormal_record` 參數
  - 創建記錄時增加 `abnormal_notes=abnormal_record or ''`

#### 批量匯入功能 (`operator_supplement_batch_create`)
- **檔案位置**: `workorder/views.py` 第7258行
- **修改內容**:
  - Excel讀取時增加第13欄位的異常紀錄讀取
  - CSV讀取時增加異常紀錄欄位的處理
  - 必要欄位檢查增加「異常紀錄」

## 📊 欄位對應關係

### SMT補登報工範本欄位順序
1. 設備
2. 公司別
3. 報工日期
4. 開始時間
5. 完成時間
6. 製令號碼
7. 機種名稱
8. 工序
9. 工作數量
10. 不良品數量
11. 備註
12. **異常紀錄** ← 新增

### 作業員補登報工範本欄位順序
1. 作業員名稱
2. 公司代號
3. 報工日期
4. 開始時間
5. 結束時間
6. 工單號
7. 產品編號
8. 工序名稱
9. 設備名稱
10. 報工數量
11. 不良品數量
12. 備註
13. **異常紀錄** ← 新增

## 🗄️ 資料庫欄位

### SMTProductionReport 模型
- **欄位名稱**: `abnormal_notes`
- **型別**: `TextField`
- **說明**: 記錄生產過程中的異常情況，如設備故障、品質問題等

### OperatorSupplementReport 模型
- **欄位名稱**: `abnormal_notes`
- **型別**: `TextField`
- **說明**: 記錄生產過程中的異常情況，如設備故障、品質問題等

## 📝 使用說明

### 正常報工
- **備註欄位**: 填寫正常生產相關說明（如「正常生產」、「大量生產」）
- **異常紀錄欄位**: 留空

### 異常報工
- **備註欄位**: 可留空或填寫一般說明
- **異常紀錄欄位**: 填寫異常情況（如「設備故障」、「品質問題」、「停電」）

## 🔍 範例資料

### SMT範例
```excel
設備,公司別,報工日期,開始時間,完成時間,製令號碼,機種名稱,工序,工作數量,不良品數量,備註,異常紀錄
SMT-A_LINE,COMP001,2024-01-15,08:00:00 AM,12:00:00 PM,WO-2024-001,PROD-001,SMT貼片,100,0,正常生產,
SMT-B_LINE,COMP001,2024-01-15,01:00:00 PM,05:00:00 PM,RD樣品,RD-001,SMT貼片,50,2,RD樣品測試,設備故障
```

### 作業員範例
```excel
作業員名稱,公司代號,報工日期,開始時間,結束時間,工單號,產品編號,工序名稱,設備名稱,報工數量,不良品數量,備註,異常紀錄
張小明,COMP001,2024-01-15,08:00:00 AM,12:00:00 PM,WO-2024-001,PROD-001,目檢,目檢台A,100,5,正常生產,
李美玲,COMP001,2024-01-15,01:00:00 PM,05:00:00 PM,,PROD-002,測試,測試設備B,50,2,RD樣品測試,設備故障
```

## ✅ 測試建議

1. **下載範本測試**: 確認Excel和CSV範本都包含異常紀錄欄位
2. **匯入測試**: 使用包含異常紀錄的範本進行匯入測試
3. **匯出測試**: 確認匯出的資料包含異常紀錄欄位
4. **資料驗證**: 確認異常紀錄正確儲存到資料庫的 `abnormal_notes` 欄位

## 🚀 部署注意事項

1. 確認資料庫模型已包含 `abnormal_notes` 欄位
2. 如有資料庫遷移，請執行 `python manage.py makemigrations` 和 `python manage.py migrate`
3. 測試所有匯入匯出功能確保正常運作
4. 更新相關文件和使用說明

## 📞 技術支援

如有任何問題或需要進一步的修改，請聯繫開發團隊。 