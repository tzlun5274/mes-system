# 📊 簡潔的報表架構說明



### 1. **report_config.py** - 報表配置
- 管理報表類型（週報、月報、季報、年報、前一個工作日報表等）
- 管理收件人、檔案格式、公司代號
- 根據報表類型自動計算日期範圍

### 2. **data_sync.py** - 資料同步
- 真正的資料同步，不是假的計數
- 將 FillWork 和 OnsiteReport 同步到 WorkOrderReportData
- 每天定時同步，確保資料一致性
- 支援強制同步和增量同步

### 3. **data_collector.py** - 資料收集
- 統一的資料收集邏輯
- 所有報表都從 WorkOrderReportData 讀取資料
- 不需要特殊邏輯，前一個工作日報表也使用統一邏輯
- 避免重複讀取不同資料來源

### 4. **report_generator.py** - 報表生成
- 負責生成報表檔案
- 支援HTML、Excel、Both格式
- 根據配置生成對應格式的報表
- 統一的報表生成邏輯

### 5. **email_service.py** - 郵件發送
- 負責發送郵件通知
- 包含附件發送功能
- 支援多個收件人

## 🔧 統一執行器

### **unified_executor.py** - 統一執行器
- 整合所有功能
- 手動和排程都使用相同的執行邏輯
- 統一的錯誤處理和日誌記錄

## 🚀 執行流程

### 資料同步流程（獨立執行）
1. **定時同步** - 每天定時執行資料同步
2. **同步資料** - 將 FillWork 和 OnsiteReport 同步到 WorkOrderReportData
3. **記錄同步結果** - 記錄同步成功或失敗

### 報表生成流程
1. **取得配置** - 從報表配置取得所有執行資訊
2. **計算日期** - 根據報表類型自動計算日期範圍
3. **收集資料** - 使用資料收集器從 WorkOrderReportData 收集報表資料
4. **生成報表** - 使用報表生成器生成檔案
5. **發送郵件** - 如果有收件人，發送郵件通知
6. **記錄結果** - 記錄執行結果和錯誤

## 📊 資料流程


### 解決方案
- **真正的資料同步**: 每天定時將原始資料同步到 WorkOrderReportData
- **統一的資料來源**: 所有報表都從 WorkOrderReportData 讀取
- **資料一致性**: 確保所有報表使用相同的資料來源

## 📋 檔案職責

| 檔案 | 職責 |
|------|------|
| `report_config.py` | 報表配置管理 |
| `data_collector.py` | 資料收集 |
| `report_generator.py` | 報表生成 |
| `email_service.py` | 郵件發送 |
| `unified_executor.py` | 統一執行器 |

## 🎯 關鍵優勢

1. **職責分離**: 每個檔案只負責一件事
2. **統一執行**: 手動和排程使用相同的邏輯
3. **易於維護**: 修改某個功能只需要修改對應檔案
4. **易於測試**: 每個組件都可以獨立測試

## 📝 總結

- **4個獨立檔案**: 配置、資料收集、報表生成、郵件發送
- **1個統一執行器**: 整合所有功能
- **手動和排程**: 使用相同的執行邏輯
- **報表類型**: 週報、月報、季報、年報、前一個工作日報表
- **配置資訊**: 收件人、檔案格式、公司代號
