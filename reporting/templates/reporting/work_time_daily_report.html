{% extends 'base.html' %}

{% block title %}工作時數日報表 - {{ report_date }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 麵包屑導航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'reporting:index' %}">報表管理</a></li>
            <li class="breadcrumb-item"><a href="{% url 'reporting:work_time_report_index' %}">工作時數報表</a></li>
            <li class="breadcrumb-item"><a href="{% url 'reporting:work_time_daily_report' %}">日報表</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ report_date }}</li>
        </ol>
    </nav>

    <!-- 報表標題 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="report-main-title">
                        <i class="fas fa-calendar-day"></i> {{ report_type }}
                    </h2>
                    <p class="text-muted mb-0">
                        報表日期：{{ report_date|date:"Y年m月d日" }} | 
                        公司代號：{{ company_code }} | 
                        生成時間：{{ generated_at|date:"Y-m-d H:i:s" }}
                    </p>
                </div>
                <div>
                    <a href="{% url 'reporting:work_time_daily_report' %}" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> 返回
                    </a>
                    <button onclick="window.print()" class="btn btn-outline-secondary">
                        <i class="fas fa-print"></i> 列印
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 統計摘要 -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <h6 class="card-title text-primary">總工作時數</h6>
                    <h3 class="mb-0">{{ summary.total_work_hours }} 小時</h3>
                    <small class="text-muted">含加班 {{ summary.total_overtime_hours }} 小時</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <h6 class="card-title text-success">總工作數量</h6>
                    <h3 class="mb-0">{{ summary.total_work_quantity }} 件</h3>
                    <small class="text-muted">合格 {{ summary.total_good_quantity }} 件</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <h6 class="card-title text-info">效率率</h6>
                    <h3 class="mb-0">{{ summary.efficiency_rate }}%</h3>
                    <small class="text-muted">目標 100%</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <h6 class="card-title text-warning">不良率</h6>
                    <h3 class="mb-0">{{ summary.defect_rate }}%</h3>
                    <small class="text-muted">良率 {{ summary.yield_rate }}%</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 詳細統計 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users"></i> 人員統計
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="text-center">
                                <h4 class="text-primary">{{ summary.unique_operators_count }}</h4>
                                <p class="text-muted mb-0">參與作業員數</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <h4 class="text-info">{{ summary.unique_equipment_count }}</h4>
                                <p class="text-muted mb-0">使用設備數</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clipboard-list"></i> 工單統計
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="text-center">
                                <h4 class="text-success">{{ summary.total_workorders_count }}</h4>
                                <p class="text-muted mb-0">工單數量</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <h4 class="text-warning">{{ summary.completion_rate }}%</h4>
                                <p class="text-muted mb-0">完工率</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 詳細資料 -->
    {% if detail %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list"></i> 詳細資料
                    </h5>
                </div>
                <div class="card-body">
                    <!-- 填報作業詳細 -->
                    {% if detail.detailed_data.fill_works %}
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-edit"></i> 填報作業記錄
                    </h6>
                    <div class="table-responsive mb-4">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>作業員</th>
                                    <th>工單號碼</th>
                                    <th>產品編號</th>
                                    <th>工序</th>
                                    <th>工作數量</th>
                                    <th>不良數量</th>
                                    <th>工作時數</th>
                                    <th>開始時間</th>
                                    <th>結束時間</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for fill_work in detail.detailed_data.fill_works %}
                                <tr>
                                    <td>{{ fill_work.operator }}</td>
                                    <td>{{ fill_work.workorder }}</td>
                                    <td>{{ fill_work.product_id }}</td>
                                    <td>{{ fill_work.process }}</td>
                                    <td>{{ fill_work.work_quantity }}</td>
                                    <td>{{ fill_work.defect_quantity }}</td>
                                    <td>{{ fill_work.work_hours }} 小時</td>
                                    <td>{{ fill_work.start_time }}</td>
                                    <td>{{ fill_work.end_time }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- 現場報工詳細 -->
                    {% if detail.detailed_data.onsite_reports %}
                    <h6 class="text-success mb-3">
                        <i class="fas fa-mobile-alt"></i> 現場報工記錄
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>作業員</th>
                                    <th>工單號碼</th>
                                    <th>產品編號</th>
                                    <th>工序</th>
                                    <th>工作分鐘</th>
                                    <th>工作時數</th>
                                    <th>開始時間</th>
                                    <th>結束時間</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for onsite_report in detail.detailed_data.onsite_reports %}
                                <tr>
                                    <td>{{ onsite_report.operator }}</td>
                                    <td>{{ onsite_report.workorder }}</td>
                                    <td>{{ onsite_report.product_id }}</td>
                                    <td>{{ onsite_report.process }}</td>
                                    <td>{{ onsite_report.work_minutes }} 分鐘</td>
                                    <td>{{ onsite_report.work_hours }} 小時</td>
                                    <td>{{ onsite_report.start_datetime }}</td>
                                    <td>{{ onsite_report.end_datetime }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- 報表註解 -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle"></i> 報表說明
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>計算說明</h6>
                            <ul>
                                <li><strong>總工作時數</strong>：包含正常工時和加班時數</li>
                                <li><strong>效率率</strong>：基於標準產能計算的實際效率</li>
                                <li><strong>不良率</strong>：不良品數量佔總產量的百分比</li>
                                <li><strong>完工率</strong>：已完成工單佔總工單的百分比</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>資料來源</h6>
                            <ul>
                                <li><strong>填報作業</strong>：作業員手動填報的工作記錄</li>
                                <li><strong>現場報工</strong>：現場即時報工的工作記錄</li>
                                <li><strong>統計時間</strong>：{{ generated_at|date:"Y-m-d H:i:s" }}</li>
                                <li><strong>資料狀態</strong>：已核准的報工記錄</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@media print {
    .btn, .breadcrumb {
        display: none !important;
    }
    
    .card {
        border: 1px solid #000 !important;
        box-shadow: none !important;
    }
    
    .container-fluid {
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
    }
}

.report-main-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: 1px solid rgba(0, 0, 0, 0.125);
}

.card-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.125);
}

.breadcrumb {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    padding: 0.75rem 1rem;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: #495057;
    background-color: #f8f9fa;
}

.table td {
    vertical-align: middle;
}

.border-primary {
    border-color: #007bff !important;
}

.border-success {
    border-color: #28a745 !important;
}

.border-info {
    border-color: #17a2b8 !important;
}

.border-warning {
    border-color: #ffc107 !important;
}
</style>
{% endblock %}
