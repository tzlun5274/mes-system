{% extends 'base.html' %}
{% load static %}

{% block title %}SMT補登填報{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="card-title">
                            <i class="fas fa-cogs"></i>
                            SMT補登填報
                        </h3>
                        <div>
                            <a href="{% url 'workorder:fill_work:fill_work_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> 返回列表
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <h5><i class="fas fa-info-circle"></i> SMT填報說明</h5>
                        <p>此為SMT設備補登填報，工序和設備都只能跟SMT有關。</p>
                    </div>

                    <form method="post" id="fillWorkForm">
                        {% csrf_token %}
                        
                        <!-- 基本資訊欄位 -->
                        <div class="row">
                            <div class="col-md-12">
                                <h5 class="text-primary">
                                    <i class="fas fa-info-circle"></i>
                                    基本資訊
                                </h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.product_id.id_for_label }}">產品編號 *</label>
                                    {{ form.product_id }}
                                    {% if form.product_id.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.product_id.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.workorder.id_for_label }}">工單號碼</label>
                                    {{ form.workorder }}
                                    {% if form.workorder.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.workorder.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.company_name.id_for_label }}">公司名稱</label>
                                    {{ form.company_name }}
                                    {% if form.company_name.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.company_name.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.operator.id_for_label }}">作業員 *</label>
                                    {{ form.operator }}
                                    {% if form.operator.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.operator.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.process.id_for_label }}">工序 *</label>
                                    {{ form.process }}
                                    {% if form.process.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.process.errors.0 }}
                                        </div>
                                    {% endif %}
                                    <small class="form-text text-muted">請選擇SMT相關工序</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.equipment.id_for_label }}">使用的設備</label>
                                    {{ form.equipment }}
                                    {% if form.equipment.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.equipment.errors.0 }}
                                        </div>
                                    {% endif %}
                                    <small class="form-text text-muted">請選擇SMT相關設備</small>
                                </div>
                            </div>
                        </div>

                        <!-- 數量資訊欄位 -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <h5 class="text-primary">
                                    <i class="fas fa-cubes"></i>
                                    數量資訊
                                </h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.planned_quantity.id_for_label }}">工單預設生產數量</label>
                                    {{ form.planned_quantity }}
                                    {% if form.planned_quantity.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.planned_quantity.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.work_quantity.id_for_label }}">工作數量 *</label>
                                    {{ form.work_quantity }}
                                    {% if form.work_quantity.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.work_quantity.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.defect_quantity.id_for_label }}">不良品數量</label>
                                    {{ form.defect_quantity }}
                                    {% if form.defect_quantity.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.defect_quantity.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="custom-control custom-checkbox">
                                        {{ form.is_completed }}
                                        <label class="custom-control-label" for="{{ form.is_completed.id_for_label }}">
                                            是否已完工
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 時間日期欄位 -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <h5 class="text-primary">
                                    <i class="fas fa-clock"></i>
                                    時間日期
                                </h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.work_date.id_for_label }}">填報日期 *</label>
                                    {{ form.work_date }}
                                    {% if form.work_date.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.work_date.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.start_time.id_for_label }}">開始時間</label>
                                    {{ form.start_time }}
                                    {% if form.start_time.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.start_time.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ form.end_time.id_for_label }}">結束時間</label>
                                    {{ form.end_time }}
                                    {% if form.end_time.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.end_time.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- 備註資訊欄位 -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <h5 class="text-primary">
                                    <i class="fas fa-sticky-note"></i>
                                    備註資訊
                                </h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ form.remarks.id_for_label }}">備註</label>
                                    {{ form.remarks }}
                                    {% if form.remarks.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.remarks.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ form.abnormal_notes.id_for_label }}">異常記錄</label>
                                    {{ form.abnormal_notes }}
                                    {% if form.abnormal_notes.errors %}
                                        <div class="invalid-feedback d-block">
                                            {{ form.abnormal_notes.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- 提交按鈕 -->
                        <div class="row mt-4">
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save"></i> 儲存SMT填報
                                </button>
                                <a href="{% url 'workorder:fill_work:fill_work_list' %}" class="btn btn-secondary btn-lg ml-2">
                                    <i class="fas fa-times"></i> 取消
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 設定今天日期為預設值
document.addEventListener('DOMContentLoaded', function() {
    const workDateField = document.getElementById('{{ form.work_date.id_for_label }}');
    if (workDateField && !workDateField.value) {
        const today = new Date().toISOString().split('T')[0];
        workDateField.value = today;
    }
});
</script>
{% endblock %} 