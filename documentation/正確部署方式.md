# ğŸš¨ æ­£ç¢ºçš„ MES ç³»çµ±éƒ¨ç½²æ–¹å¼

## âš ï¸ é‡è¦æé†’
æ¸¬è©¦ä¸»æ©Ÿç­‰åŒæ–¼æ­£å¼ä¸»æ©Ÿï¼Œå¿…é ˆä½¿ç”¨ç³»çµ±æœå‹™éƒ¨ç½²ï¼Œé¿å…é‡é–‹æ©Ÿå¾Œç³»çµ±æ¶ˆå¤±ï¼

## ğŸ› ï¸ æ­£ç¢ºçš„éƒ¨ç½²æ­¥é©Ÿ

### 1. è¤‡è£½æª”æ¡ˆåˆ°æ¸¬è©¦ä¸»æ©Ÿ
ä½¿ç”¨ WinSCP è¤‡è£½å¿…è¦æª”æ¡ˆåˆ°ï¼š`/var/www/mes_test/`

### 2. å»ºç«‹ç³»çµ±æœå‹™æª”æ¡ˆ

#### å»ºç«‹ Django æœå‹™æª”æ¡ˆ
```bash
# åœ¨æ¸¬è©¦ä¸»æ©Ÿä¸Šå»ºç«‹æœå‹™æª”æ¡ˆ
sudo nano /etc/systemd/system/mes-test.service
```

æœå‹™æª”æ¡ˆå…§å®¹ï¼š
```ini
[Unit]
Description=MES Test Server
After=network.target postgresql.service redis.service

[Service]
Type=simple
User=mes
Group=mes
WorkingDirectory=/var/www/mes_test
Environment=DJANGO_SETTINGS_MODULE=mes_config.settings_test
ExecStart=/usr/bin/python3 manage.py runserver 0.0.0.0:8001
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### å»ºç«‹ Celery æœå‹™æª”æ¡ˆ
```bash
sudo nano /etc/systemd/system/mes-test-celery.service
```

æœå‹™æª”æ¡ˆå…§å®¹ï¼š
```ini
[Unit]
Description=MES Test Celery Worker
After=network.target redis.service

[Service]
Type=simple
User=mes
Group=mes
WorkingDirectory=/var/www/mes_test
Environment=DJANGO_SETTINGS_MODULE=mes_config.settings_test
ExecStart=/usr/bin/celery -A mes_config worker -l info
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### 3. å•Ÿç”¨ç³»çµ±æœå‹™
```bash
# é‡æ–°è¼‰å…¥ç³»çµ±æœå‹™
sudo systemctl daemon-reload

# å•Ÿç”¨æœå‹™ (é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•)
sudo systemctl enable mes-test.service
sudo systemctl enable mes-test-celery.service

# å•Ÿå‹•æœå‹™
sudo systemctl start mes-test.service
sudo systemctl start mes-test-celery.service

# æª¢æŸ¥æœå‹™ç‹€æ…‹
sudo systemctl status mes-test.service
sudo systemctl status mes-test-celery.service
```

### 4. è¨­å®š Nginx (å¯é¸)
```bash
# å»ºç«‹ Nginx è¨­å®šæª”æ¡ˆ
sudo nano /etc/nginx/sites-available/mes-test
```

Nginx è¨­å®šå…§å®¹ï¼š
```nginx
server {
    listen 80;
    server_name 192.168.1.28;

    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /static/ {
        alias /var/www/mes_test/static/;
    }
}
```

```bash
# å•Ÿç”¨ Nginx è¨­å®š
sudo ln -s /etc/nginx/sites-available/mes-test /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

## ğŸ”§ æœå‹™ç®¡ç†å‘½ä»¤

### å•Ÿå‹•/åœæ­¢æœå‹™
```bash
# å•Ÿå‹•æœå‹™
sudo systemctl start mes-test.service
sudo systemctl start mes-test-celery.service

# åœæ­¢æœå‹™
sudo systemctl stop mes-test.service
sudo systemctl stop mes-test-celery.service

# é‡å•Ÿæœå‹™
sudo systemctl restart mes-test.service
sudo systemctl restart mes-test-celery.service
```

### æŸ¥çœ‹æœå‹™ç‹€æ…‹
```bash
# æŸ¥çœ‹æœå‹™ç‹€æ…‹
sudo systemctl status mes-test.service
sudo systemctl status mes-test-celery.service

# æŸ¥çœ‹æœå‹™æ—¥èªŒ
sudo journalctl -u mes-test.service -f
sudo journalctl -u mes-test-celery.service -f
```

### é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
```bash
# å•Ÿç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
sudo systemctl enable mes-test.service
sudo systemctl enable mes-test-celery.service

# ç¦ç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
sudo systemctl disable mes-test.service
sudo systemctl disable mes-test-celery.service
```

## ğŸŒ è¨ªå•åœ°å€

- **ç›´æ¥è¨ªå•**: http://192.168.1.28:8001
- **Nginx ä»£ç†**: http://192.168.1.28 (å¦‚æœè¨­å®šäº† Nginx)

## ğŸ”„ æ›´æ–°éƒ¨ç½²

ç•¶æœ‰æ–°åŠŸèƒ½æ™‚ï¼š

1. **è¤‡è£½æ›´æ–°æª”æ¡ˆ**
   ```bash
   # ä½¿ç”¨ WinSCP è¤‡è£½æ›´æ–°çš„æ¨¡çµ„
   ```

2. **åŸ·è¡Œè³‡æ–™åº«é·ç§»**
   ```bash
   cd /var/www/mes_test
   export DJANGO_SETTINGS_MODULE=mes_config.settings_test
   python3 manage.py migrate
   ```

3. **é‡å•Ÿæœå‹™**
   ```bash
   sudo systemctl restart mes-test.service
   sudo systemctl restart mes-test-celery.service
   ```

## ğŸ›¡ï¸ å®‰å…¨è¨­å®š

### é˜²ç«ç‰†è¨­å®š
```bash
# é–‹æ”¾å¿…è¦ç«¯å£
sudo ufw allow 8001
sudo ufw allow 80
sudo ufw allow 22
```

### è³‡æ–™åº«å®‰å…¨
```bash
# è¨­å®šè³‡æ–™åº«å¯†ç¢¼
sudo -u postgres psql
ALTER USER mes_test_user WITH PASSWORD 'strong_password';
\q
```

## ğŸ“Š ç›£æ§å’Œç¶­è­·

### æŸ¥çœ‹ç³»çµ±è³‡æº
```bash
# æŸ¥çœ‹è¨˜æ†¶é«”ä½¿ç”¨
free -h

# æŸ¥çœ‹ç£ç¢Ÿä½¿ç”¨
df -h

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
sudo systemctl status mes-test*
```

### å‚™ä»½è³‡æ–™
```bash
# å‚™ä»½è³‡æ–™åº«
pg_dump -h localhost -U mes_test_user mes_test_db > backup_$(date +%Y%m%d).sql

# å‚™ä»½ç¨‹å¼ç¢¼
tar -czf mes_backup_$(date +%Y%m%d).tar.gz /var/www/mes_test/
```

---

**ğŸ’¡ é‡è¦**: ä½¿ç”¨ç³»çµ±æœå‹™éƒ¨ç½²å¾Œï¼Œç³»çµ±æœƒåœ¨é‡é–‹æ©Ÿå¾Œè‡ªå‹•å•Ÿå‹•ï¼Œä¸æœƒæ¶ˆå¤±ï¼
