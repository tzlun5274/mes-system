# MES 系統腳本使用說明

## 📋 腳本功能分類

### 🚀 部署腳本

#### 1. 全新部署.sh
**用途**: 從零開始完整部署 MES 系統
**功能**:
- 清理之前的安裝
- 安裝系統套件 (PostgreSQL, Redis, Nginx)
- 建立系統用戶和目錄
- 配置資料庫和服務
- 部署專案檔案
- 建立環境變數
- 安裝 Python 依賴
- 執行資料庫遷移
- 建立系統服務
- 啟動所有服務

**使用時機**: 
- 全新伺服器部署
- 需要重新安裝系統
- 測試環境重置

**執行方式**:
```bash
sudo ./全新部署.sh
```

#### 2. 專案更新.sh
**用途**: 更新專案內容和資料庫遷移
**功能**:
- 備份當前專案
- 複製新專案檔案
- 安裝 Python 依賴
- 執行資料庫遷移
- 收集靜態檔案
- 重啟服務

**使用時機**:
- 開發新功能後更新
- 修復 Bug 後更新
- 定期專案更新

**執行方式**:
```bash
sudo ./專案更新.sh
```

### 🧹 清理腳本

#### 3. 清理舊安裝.sh
**用途**: 完全清理 MES 系統並回到初始狀態
**功能**:
- 停止所有服務
- 移除系統服務檔案
- 清理專案目錄（自動備份）
- 清理 Nginx 配置
- 清理日誌檔案
- 清理 Python 快取
- 清理 Redis 資料
- 清理資料庫
- 清理系統用戶
- 移除所有 Python 套件
- 移除所有系統套件
- 清理配置檔案
- 清理臨時檔案

**使用時機**:
- 需要完全移除 MES 系統
- 重新開始部署
- 系統重置

**執行方式**:
```bash
sudo ./清理舊安裝.sh
```

#### 4. 完全清理系統.sh
**用途**: 需要確認的徹底清理
**功能**: 與清理舊安裝.sh 相同，但需要輸入 'YES' 確認
**使用時機**: 需要額外確認的清理操作
**執行方式**:
```bash
sudo ./完全清理系統.sh
```

### 🔧 工具腳本

#### 5. 環境需求檢查.sh
**用途**: 檢查系統是否滿足 MES 部署需求
**功能**:
- 檢查系統套件
- 檢查 Python 套件
- 檢查服務狀態
- 檢查目錄權限
- 檢查端口可用性
- 檢查系統資源

**使用時機**:
- 部署前檢查
- 故障排除
- 系統維護

**執行方式**:
```bash
./環境需求檢查.sh
```

#### 6. 修復Celery服務.sh
**用途**: 修復 Celery Worker 和 Celery Beat 服務
**功能**:
- 重新配置 Celery 服務
- 修正服務檔案
- 重啟 Celery 服務
- 檢查服務狀態

**使用時機**:
- Celery 服務啟動失敗
- 背景任務無法執行
- 服務配置問題

**執行方式**:
```bash
sudo ./修復Celery服務.sh
```

#### 7. 複製到測試主機.sh
**用途**: 將專案複製到測試主機
**功能**:
- 檢查 SSH 連線
- 建立目標目錄
- 複製專案檔案
- 設定檔案權限

**使用時機**:
- 開發主機到測試主機的檔案傳輸
- 準備測試部署

**執行方式**:
```bash
./複製到測試主機.sh
```

### 📦 打包腳本

#### 8. create_deployment_package.sh
**用途**: 建立部署套件
**功能**:
- 複製核心模組
- 複製設定檔案
- 複製前端檔案
- 複製部署腳本
- 複製重要文件
- 清理垃圾檔案
- 建立壓縮套件

**使用時機**:
- 準備部署套件
- 傳輸到其他主機

**執行方式**:
```bash
./create_deployment_package.sh
```

## 📋 部署流程建議

### 全新部署流程
1. 執行 `環境需求檢查.sh` 檢查系統
2. 執行 `全新部署.sh` 完整部署
3. 驗證系統運行狀態

### 專案更新流程
1. 開發新功能或修復 Bug
2. 執行 `專案更新.sh` 更新專案
3. 驗證更新結果

### 系統重置流程
1. 執行 `清理舊安裝.sh` 完全清理
2. 執行 `全新部署.sh` 重新部署

### 故障排除流程
1. 執行 `環境需求檢查.sh` 檢查系統
2. 執行 `修復Celery服務.sh` 修復服務
3. 檢查服務日誌和狀態

## ⚠️ 注意事項

1. **權限要求**: 大部分腳本需要 sudo 權限
2. **備份機制**: 清理腳本會自動備份專案
3. **確認機制**: 重要操作會要求確認
4. **日誌記錄**: 所有操作都會記錄日誌
5. **回滾機制**: 更新腳本會建立備份，可手動回滾

## 📞 故障排除

### 常見問題
1. **服務啟動失敗**: 檢查日誌 `journalctl -u 服務名稱`
2. **資料庫連線失敗**: 檢查 PostgreSQL 服務和配置
3. **Celery 任務失敗**: 執行 `修復Celery服務.sh`
4. **權限問題**: 檢查檔案和目錄權限

### 日誌位置
- 應用程式日誌: `/var/log/mes/`
- 系統服務日誌: `journalctl -u 服務名稱`
- 部署日誌: `/var/log/mes/deploy.log`
