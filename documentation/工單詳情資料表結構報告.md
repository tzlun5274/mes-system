# 工單詳情資料表結構報告

## 📊 總覽

工單管理系統包含 **4個主要子模組**，總共 **20個資料表**，涵蓋了從ERP同步、工單管理、派工管理到填報管理的完整流程。

## 🏗️ 資料表結構詳解

### 1. 工單管理主模組 (workorder)
**資料表數量：14個**

#### 核心工單資料表
- **`workorder_workorder`** - 工單主表
  - 功能：記錄工單基本資訊、狀態、數量等
  - 關鍵欄位：公司代號、工單號碼、產品編號、數量、狀態

#### 工序管理資料表
- **`workorder_workorderprocess`** - 工單工序明細
  - 功能：記錄工單的工序步驟和執行狀態
  - 關鍵欄位：工序名稱、步驟順序、分配設備、分配作業員

- **`workorder_workorderprocesslog`** - 工單工序日誌
  - 功能：記錄工序執行過程的日誌
  - 關鍵欄位：操作類型、操作時間、操作人員

#### 分配管理資料表
- **`workorder_assignment`** - 工單分配
  - 功能：記錄工單分配給作業員和設備的資訊
  - 關鍵欄位：分配時間、分配人員、分配設備

- **`workorder_process_capacity`** - 工序產能設定
  - 功能：設定各工序的產能限制
  - 關鍵欄位：工序名稱、產能上限、時間設定

#### 生產管理資料表
- **`workorder_production`** - 生產中工單
  - 功能：記錄正在生產中的工單狀態
  - 關鍵欄位：生產狀態、開始時間、預計完成時間

- **`workorder_production_detail`** - 生產報工明細
  - 功能：記錄生產過程中的詳細報工記錄
  - 關鍵欄位：報工時間、合格品數量、不良品數量、作業員

#### 完工管理資料表
- **`workorder_completed_workorder`** - 已完工工單
  - 功能：記錄已完成生產的工單資訊
  - 關鍵欄位：完工時間、實際完成數量、總工時

- **`workorder_completed_workorder_process`** - 已完工工單工序
  - 功能：記錄已完工工單的工序完成情況
  - 關鍵欄位：工序完成時間、工序完成數量

- **`workorder_completed_production_report`** - 已完工生產報工記錄
  - 功能：記錄已完工工單的所有報工記錄
  - 關鍵欄位：報工日期、報工數量、作業員

#### 自動化管理資料表
- **`workorder_auto_allocation_settings`** - 自動分配設定
  - 功能：設定自動分配工單的規則
  - 關鍵欄位：分配規則、觸發條件

- **`workorder_auto_allocation_log`** - 自動分配執行記錄
  - 功能：記錄自動分配執行的日誌
  - 關鍵欄位：執行時間、執行結果、分配對象

- **`workorder_auto_management_config`** - 自動管理功能設定
  - 功能：設定各種自動化功能的參數
  - 關鍵欄位：功能類型、執行間隔、啟用狀態

#### 其他資料表
- **`workorder_dispatchlog`** - 派工單記錄
  - 功能：記錄派工操作的歷史記錄
  - 關鍵欄位：派工時間、派工人員、派工對象

### 2. 派工單管理子模組 (workorder_dispatch)
**資料表數量：3個**

- **`workorder_dispatch`** - 派工單主表
  - 功能：記錄派工單的基本資訊和狀態
  - 關鍵欄位：公司代號、工單號碼、產品編號、派工狀態、分配作業員

- **`workorder_dispatch_process`** - 派工單工序
  - 功能：記錄派工單的工序明細
  - 關鍵欄位：工序名稱、計劃時間、實際時間

- **`workorder_dispatch_history`** - 派工歷史
  - 功能：記錄派工單的狀態變更歷史
  - 關鍵欄位：變更時間、變更人員、變更內容

### 3. 填報管理子模組 (fill_work)
**資料表數量：1個**

- **`workorder_fill_work`** - 填報作業
  - 功能：記錄所有類型的填報作業記錄
  - 關鍵欄位：作業員、工單號碼、工序、工作時間、數量、核准狀態

### 4. ERP整合子模組 (workorder_erp)
**資料表數量：2個**

- **`workorder_manufacturing_order`** - 製造訂單
  - 功能：整合各公司的製造訂單資料
  - 關鍵欄位：公司代號、製造訂單號、產品資訊

- **`workorder_manufacturing_order_systemconfig`** - 系統設定
  - 功能：ERP整合相關的系統設定
  - 關鍵欄位：設定項目、設定值

## 🔗 資料表關聯關係

### 主要關聯
1. **工單主表** (`workorder_workorder`) 是核心，關聯到：
   - 工序明細 (`workorder_workorderprocess`)
   - 生產記錄 (`workorder_production`)
   - 已完工記錄 (`workorder_completed_workorder`)

2. **派工單** (`workorder_dispatch`) 關聯到：
   - 工單主表 (透過公司代號+工單號碼)
   - 工序明細 (`workorder_dispatch_process`)
   - 歷史記錄 (`workorder_dispatch_history`)

3. **填報記錄** (`workorder_fill_work`) 關聯到：
   - 工單主表 (透過工單號碼)
   - 工序表 (透過工序ID)

### 資料流向
```
ERP系統 → ERP整合表 → 工單主表 → 派工單 → 填報記錄 → 生產記錄 → 已完工記錄
```

## 📈 資料表統計

| 模組 | 資料表數量 | 主要功能 |
|------|------------|----------|
| 工單管理主模組 | 14個 | 工單生命週期管理 |
| 派工單管理子模組 | 3個 | 派工流程管理 |
| 填報管理子模組 | 1個 | 報工記錄管理 |
| ERP整合子模組 | 2個 | ERP資料同步 |
| **總計** | **20個** | **完整工單管理系統** |

## 🎯 工單詳情頁面資料來源

當查看工單詳情時，系統會從以下資料表取得資料：

1. **基本資訊**：`workorder_workorder`
2. **工序資訊**：`workorder_workorderprocess`
3. **派工資訊**：`workorder_dispatch`
4. **填報記錄**：`workorder_fill_work`
5. **生產記錄**：`workorder_production_detail`
6. **公司資訊**：`workorder_manufacturing_order`

## ⚠️ 注意事項

1. **唯一性約束**：工單主表使用 `(公司代號, 工單號碼, 產品編號)` 作為唯一識別
2. **資料同步**：ERP資料會定期同步到本地資料表
3. **狀態管理**：工單狀態會影響相關資料表的記錄
4. **歷史記錄**：重要操作都會保留歷史記錄
5. **自動化**：系統支援多種自動化功能

這個完整的資料表結構確保了工單管理系統能夠處理從ERP同步到完工的完整流程，並提供詳細的追蹤和分析功能。 