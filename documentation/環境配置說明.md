# MES 系統環境配置說明

## ⚠️ 重要警告

**部署前必須修改 `.env` 檔案，否則系統無法正常運行！**

## 📋 必須修改的配置項目

### 1. 主機 IP 地址
```bash
# 找到並修改以下兩行
ALLOWED_HOSTS=localhost,127.0.0.1,192.168.1.21  # 改為目標主機 IP
HOST_IP=192.168.1.21  # 改為目標主機 IP
```

### 2. 資料庫密碼（建議修改）
```bash
# 建議修改資料庫密碼
DATABASE_PASSWORD=mes_password  # 改為更安全的密碼
```

### 3. Redis 密碼（建議修改）
```bash
# 建議修改 Redis 密碼
REDIS_PASSWORD=mesredis2025  # 改為更安全的密碼
```

### 4. 管理員密碼（必須修改）
```bash
# 必須修改管理員密碼
SUPERUSER_PASSWORD=1234  # 改為安全的密碼
```

### 5. 郵件設定（可選）
```bash
# 如果需要郵件功能，請修改以下設定
EMAIL_HOST_USER=user@gmail.com  # 改為實際郵件帳號
EMAIL_HOST_PASSWORD=user_password  # 改為實際郵件密碼
```

## 🔧 修改步驟

### 步驟 1: 解壓縮部署套件
```bash
tar -xzf mes_deployment_package_*.tar.gz
cd mes_deployment_package_*
```

### 步驟 2: 編輯 .env 檔案
```bash
# 使用 nano 編輯器
nano .env

# 或使用 vim 編輯器
vim .env
```

### 步驟 3: 修改關鍵配置
找到並修改以下項目：

1. **ALLOWED_HOSTS**: 加入目標主機 IP
2. **HOST_IP**: 改為目標主機 IP
3. **DATABASE_PASSWORD**: 改為安全密碼
4. **REDIS_PASSWORD**: 改為安全密碼
5. **SUPERUSER_PASSWORD**: 改為安全密碼

### 步驟 4: 儲存並退出
- nano: `Ctrl+X` → `Y` → `Enter`
- vim: `Esc` → `:wq` → `Enter`

## 📋 配置範例

### 開發環境配置
```bash
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1,192.168.1.28
HOST_IP=192.168.1.28
DATABASE_PASSWORD=dev_password_123
REDIS_PASSWORD=dev_redis_456
SUPERUSER_PASSWORD=admin_789
```

### 生產環境配置
```bash
DEBUG=False
ALLOWED_HOSTS=localhost,127.0.0.1,192.168.1.100
HOST_IP=192.168.1.100
DATABASE_PASSWORD=prod_secure_password_2025
REDIS_PASSWORD=prod_redis_secure_2025
SUPERUSER_PASSWORD=prod_admin_secure_2025
```

## ⚠️ 常見錯誤

### 錯誤 1: 網站無法訪問
**原因**: ALLOWED_HOSTS 未包含正確的 IP 地址
**解決**: 修改 ALLOWED_HOSTS 加入目標主機 IP

### 錯誤 2: 資料庫連線失敗
**原因**: 資料庫密碼錯誤或資料庫未建立
**解決**: 檢查 DATABASE_PASSWORD 和資料庫設定

### 錯誤 3: Redis 連線失敗
**原因**: Redis 密碼錯誤或 Redis 未啟動
**解決**: 檢查 REDIS_PASSWORD 和 Redis 服務狀態

### 錯誤 4: 管理員無法登入
**原因**: 管理員密碼未修改或資料庫未初始化
**解決**: 修改 SUPERUSER_PASSWORD 並重新執行部署

## 🔍 驗證配置

### 檢查 .env 檔案
```bash
# 檢查檔案是否存在
ls -la .env

# 檢查檔案內容
cat .env

# 檢查檔案權限
ls -la .env | awk '{print $1, $3, $4}'
```

### 檢查配置是否正確
```bash
# 檢查 IP 地址
grep "HOST_IP" .env
grep "ALLOWED_HOSTS" .env

# 檢查密碼是否已修改
grep "PASSWORD" .env
```

## 📞 故障排除

### 如果忘記修改配置
1. 停止部署腳本
2. 修改 .env 檔案
3. 重新執行部署腳本

### 如果部署後發現配置錯誤
1. 停止服務: `sudo systemctl stop mes`
2. 修改 .env 檔案
3. 重啟服務: `sudo systemctl start mes`

### 如果需要重新生成配置
```bash
# 刪除現有 .env 檔案
rm .env

# 重新編輯配置
nano .env
```

## 💡 安全建議

1. **使用強密碼**: 密碼至少 12 位，包含大小寫字母、數字和符號
2. **定期更換密碼**: 建議每 3 個月更換一次密碼
3. **限制檔案權限**: 確保 .env 檔案權限為 640
4. **備份配置**: 定期備份 .env 檔案
5. **生產環境**: 將 DEBUG 設為 False

## 📋 完整部署流程

1. 解壓縮部署套件
2. **修改 .env 檔案** ⚠️ 重要！
3. 執行 `sudo ./全新部署.sh`
4. 驗證系統運行狀態
5. 登入管理後台測試

**記住：不修改 .env 檔案，系統無法正常運行！**
