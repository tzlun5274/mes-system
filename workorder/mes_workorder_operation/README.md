# MES å·¥å–®ä½œæ¥­å­æ¨¡çµ„

## ğŸ“‹ æ¦‚è¿°

MES å·¥å–®ä½œæ¥­å­æ¨¡çµ„æ˜¯ MES ç³»çµ±çš„æ ¸å¿ƒçµ„ä»¶ä¹‹ä¸€ï¼Œå°ˆé–€è² è²¬ç®¡ç† MES å·¥å–®çš„ä½œæ¥­æµç¨‹ã€‚æœ¬æ¨¡çµ„æä¾›å®Œæ•´çš„ä½œæ¥­ç”Ÿå‘½é€±æœŸç®¡ç†ï¼Œå¾ä½œæ¥­å»ºç«‹ã€åŸ·è¡Œåˆ°å®Œæˆçš„å…¨ç¨‹è¿½è¹¤ã€‚

## ğŸ—ï¸ åŠŸèƒ½ç‰¹è‰²

### 1. å®Œæ•´çš„ä½œæ¥­ç®¡ç†
- **ä½œæ¥­å»ºç«‹**ï¼šæ”¯æ´æ‰‹å‹•å»ºç«‹å’Œè‡ªå‹•å»ºç«‹ä½œæ¥­
- **ä½œæ¥­åŸ·è¡Œ**ï¼šè¿½è¹¤ä½œæ¥­çš„åŸ·è¡Œç‹€æ…‹å’Œé€²åº¦
- **ä½œæ¥­å®Œæˆ**ï¼šè‡ªå‹•è¨ˆç®—å®Œæˆç‡å’Œå‰©é¤˜æ•¸é‡
- **ä½œæ¥­æ­·å²**ï¼šå®Œæ•´çš„ä½œæ¥­è®Šæ›´æ­·å²è¨˜éŒ„

### 2. å¤šå…¬å¸æ¶æ§‹æ”¯æ´
- **å…¬å¸éš”é›¢**ï¼šä¸åŒå…¬å¸çš„ä½œæ¥­è³‡æ–™å®Œå…¨éš”é›¢
- **å”¯ä¸€è­˜åˆ¥**ï¼šå…¬å¸ä»£è™Ÿ + å·¥å–®è™Ÿç¢¼ + ç”¢å“ç·¨è™Ÿ + ä½œæ¥­åç¨±
- **è³‡æ–™å®‰å…¨**ï¼šç¢ºä¿è·¨å…¬å¸è³‡æ–™ä¸æœƒæ··æ·†

### 3. æ™ºèƒ½ç‹€æ…‹ç®¡ç†
- **è‡ªå‹•ç‹€æ…‹æ›´æ–°**ï¼šæ ¹æ“šå®Œæˆæ•¸é‡è‡ªå‹•æ›´æ–°ä½œæ¥­ç‹€æ…‹
- **æ™‚é–“è¿½è¹¤**ï¼šè‡ªå‹•è¨˜éŒ„é–‹å§‹æ™‚é–“å’Œå®Œæˆæ™‚é–“
- **å®Œæˆç‡è¨ˆç®—**ï¼šå¯¦æ™‚è¨ˆç®—ä½œæ¥­å®Œæˆç‡

### 4. è©³ç´°ä½œæ¥­æ˜ç´°
- **æ˜ç´°ç®¡ç†**ï¼šæ”¯æ´å¤šç¨®æ˜ç´°é¡å‹ï¼ˆå·¥åºã€ç‰©æ–™ã€è¨­å‚™ã€å“è³ªç­‰ï¼‰
- **é€²åº¦è¿½è¹¤**ï¼šæ¯å€‹æ˜ç´°é …ç›®çš„å®Œæˆæƒ…æ³
- **æ™‚é•·è¨ˆç®—**ï¼šè‡ªå‹•è¨ˆç®—ä½œæ¥­æ™‚é•·

### 5. å®Œæ•´çš„æ­·å²è¨˜éŒ„
- **è®Šæ›´è¿½è¹¤**ï¼šè¨˜éŒ„æ‰€æœ‰ä½œæ¥­è®Šæ›´çš„æ­·å²
- **æ“ä½œå¯©è¨ˆ**ï¼šè¨˜éŒ„æ“ä½œè€…å’Œæ“ä½œæ™‚é–“
- **è®Šæ›´å°æ¯”**ï¼šæ”¯æ´è®Šæ›´å‰å¾Œå€¼çš„å°æ¯”

## ğŸ“Š è³‡æ–™æ¨¡å‹

### 1. MesWorkorderOperationï¼ˆä½œæ¥­ä¸»è¡¨ï¼‰
```python
- id: ä¸»éµ
- company_code: å…¬å¸ä»£è™Ÿ
- company_name: å…¬å¸åç¨±
- workorder_number: å·¥å–®è™Ÿç¢¼
- product_code: ç”¢å“ç·¨è™Ÿ
- product_name: ç”¢å“åç¨±
- operation_type: ä½œæ¥­é¡å‹ï¼ˆç”Ÿç”¢ã€æª¢é©—ã€åŒ…è£ã€ç¶­è­·ã€å…¶ä»–ï¼‰
- operation_name: ä½œæ¥­åç¨±
- status: ä½œæ¥­ç‹€æ…‹ï¼ˆå¾…ä½œæ¥­ã€ä½œæ¥­ä¸­ã€æš«åœã€å·²å®Œæˆã€å·²å–æ¶ˆï¼‰
- planned_quantity: è¨ˆåŠƒæ•¸é‡
- completed_quantity: å®Œæˆæ•¸é‡
- defect_quantity: ä¸è‰¯å“æ•¸é‡
- planned_start_date: è¨ˆåŠƒé–‹å§‹æ—¥æœŸ
- planned_end_date: è¨ˆåŠƒå®Œæˆæ—¥æœŸ
- actual_start_date: å¯¦éš›é–‹å§‹æ™‚é–“
- actual_end_date: å¯¦éš›å®Œæˆæ™‚é–“
- assigned_operator: åˆ†é…ä½œæ¥­å“¡
- assigned_equipment: åˆ†é…è¨­å‚™
- notes: å‚™è¨»
- created_at: å»ºç«‹æ™‚é–“
- updated_at: æ›´æ–°æ™‚é–“
- created_by: å»ºç«‹è€…
- updated_by: æ›´æ–°è€…
```

### 2. MesWorkorderOperationDetailï¼ˆä½œæ¥­æ˜ç´°ï¼‰
```python
- id: ä¸»éµ
- operation: é—œè¯ä½œæ¥­ä¸»è¡¨
- detail_type: æ˜ç´°é¡å‹ï¼ˆå·¥åºã€ç‰©æ–™ã€è¨­å‚™ã€å“è³ªã€å…¶ä»–ï¼‰
- detail_name: æ˜ç´°åç¨±
- detail_description: æ˜ç´°èªªæ˜
- planned_quantity: è¨ˆåŠƒæ•¸é‡
- actual_quantity: å¯¦éš›æ•¸é‡
- start_time: é–‹å§‹æ™‚é–“
- end_time: çµæŸæ™‚é–“
- is_completed: æ˜¯å¦å®Œæˆ
- completion_rate: å®Œæˆç‡
- notes: å‚™è¨»
- created_at: å»ºç«‹æ™‚é–“
- updated_at: æ›´æ–°æ™‚é–“
```

### 3. MesWorkorderOperationHistoryï¼ˆä½œæ¥­æ­·å²ï¼‰
```python
- id: ä¸»éµ
- operation: é—œè¯ä½œæ¥­ä¸»è¡¨
- history_type: æ­·å²é¡å‹ï¼ˆå»ºç«‹ã€æ›´æ–°ã€é–‹å§‹ã€æš«åœã€é‡å•Ÿã€å®Œæˆã€å–æ¶ˆã€åˆªé™¤ï¼‰
- history_description: æ­·å²èªªæ˜
- old_values: è®Šæ›´å‰å€¼ï¼ˆJSONæ ¼å¼ï¼‰
- new_values: è®Šæ›´å¾Œå€¼ï¼ˆJSONæ ¼å¼ï¼‰
- operator: æ“ä½œè€…
- ip_address: IPä½å€
- created_at: å»ºç«‹æ™‚é–“
```

## ğŸ”§ æœå‹™å±¤åŠŸèƒ½

### 1. MesWorkorderOperationService
- `create_operation()`: å»ºç«‹ä½œæ¥­
- `get_operation_by_id()`: æ ¹æ“šIDå–å¾—ä½œæ¥­
- `get_operations_by_workorder()`: æ ¹æ“šå·¥å–®å–å¾—ä½œæ¥­
- `search_operations()`: æœå°‹ä½œæ¥­
- `update_operation_status()`: æ›´æ–°ä½œæ¥­ç‹€æ…‹
- `bulk_update_status()`: æ‰¹é‡æ›´æ–°ç‹€æ…‹
- `get_operation_statistics()`: å–å¾—çµ±è¨ˆè³‡è¨Š

### 2. MesWorkorderOperationDetailService
- `create_detail()`: å»ºç«‹æ˜ç´°
- `update_detail_completion()`: æ›´æ–°æ˜ç´°å®Œæˆæƒ…æ³
- `get_operation_details()`: å–å¾—ä½œæ¥­æ˜ç´°

### 3. MesWorkorderOperationHistoryService
- `get_operation_history()`: å–å¾—ä½œæ¥­æ­·å²
- `get_recent_activities()`: å–å¾—æœ€è¿‘æ´»å‹•

## ğŸ“ ä½¿ç”¨ç¯„ä¾‹

### å»ºç«‹ä½œæ¥­
```python
from workorder.mes_workorder_operation.services import MesWorkorderOperationService

# å»ºç«‹æ–°ä½œæ¥­
operation = MesWorkorderOperationService.create_operation(
    company_code='01',
    workorder_number='WO-2025-001',
    product_code='PROD-001',
    operation_name='çµ„è£ä½œæ¥­',
    operation_type='production',
    planned_quantity=100,
    assigned_operator='å¼µä¸‰',
    assigned_equipment='çµ„è£ç·šA'
)
```

### æ›´æ–°ä½œæ¥­ç‹€æ…‹
```python
# é–‹å§‹ä½œæ¥­
operation = MesWorkorderOperationService.update_operation_status(
    operation_id=1,
    new_status='in_progress',
    operator='æå››'
)

# å®Œæˆä½œæ¥­
operation = MesWorkorderOperationService.update_operation_status(
    operation_id=1,
    new_status='completed',
    operator='æå››'
)
```

### æœå°‹ä½œæ¥­
```python
# æœå°‹ç‰¹å®šå…¬å¸çš„ä½œæ¥­
filters = {
    'company_code': '01',
    'status': 'in_progress',
    'date_from': '2025-01-01'
}
operations = MesWorkorderOperationService.search_operations(filters)
```

## ğŸ”— èˆ‡å…¶ä»–æ¨¡çµ„çš„æ•´åˆ

### 1. èˆ‡å·¥å–®ç®¡ç†æ¨¡çµ„æ•´åˆ
- å¾å·¥å–®ç®¡ç†æ¨¡çµ„å–å¾—å·¥å–®è³‡è¨Š
- è‡ªå‹•å»ºç«‹å°æ‡‰çš„ä½œæ¥­è¨˜éŒ„
- åŒæ­¥å·¥å–®ç‹€æ…‹å’Œä½œæ¥­ç‹€æ…‹

### 2. èˆ‡æ´¾å·¥å–®æ¨¡çµ„æ•´åˆ
- æ´¾å·¥å–®å®Œæˆå¾Œè‡ªå‹•å»ºç«‹ä½œæ¥­
- ä½œæ¥­é€²åº¦å½±éŸ¿æ´¾å·¥å–®ç‹€æ…‹
- å…±äº«ä½œæ¥­å“¡å’Œè¨­å‚™è³‡è¨Š

### 3. èˆ‡å¡«å ±ç®¡ç†æ¨¡çµ„æ•´åˆ
- å¡«å ±è¨˜éŒ„å½±éŸ¿ä½œæ¥­é€²åº¦
- ä½œæ¥­å®Œæˆç‡å½±éŸ¿å¡«å ±çµ±è¨ˆ
- å…±äº«å®Œæˆæ•¸é‡è³‡è¨Š

## âš™ï¸ é…ç½®èªªæ˜

### 1. ä½œæ¥­é¡å‹é…ç½®
```python
OPERATION_TYPE_CHOICES = [
    ('production', 'ç”Ÿç”¢ä½œæ¥­'),
    ('inspection', 'æª¢é©—ä½œæ¥­'),
    ('packaging', 'åŒ…è£ä½œæ¥­'),
    ('maintenance', 'ç¶­è­·ä½œæ¥­'),
    ('other', 'å…¶ä»–ä½œæ¥­'),
]
```

### 2. ä½œæ¥­ç‹€æ…‹é…ç½®
```python
STATUS_CHOICES = [
    ('pending', 'å¾…ä½œæ¥­'),
    ('in_progress', 'ä½œæ¥­ä¸­'),
    ('paused', 'æš«åœ'),
    ('completed', 'å·²å®Œæˆ'),
    ('cancelled', 'å·²å–æ¶ˆ'),
]
```

### 3. æ˜ç´°é¡å‹é…ç½®
```python
DETAIL_TYPE_CHOICES = [
    ('process', 'å·¥åº'),
    ('material', 'ç‰©æ–™'),
    ('equipment', 'è¨­å‚™'),
    ('quality', 'å“è³ª'),
    ('other', 'å…¶ä»–'),
]
```

## ğŸ“ˆ çµ±è¨ˆåŠŸèƒ½

### 1. ä½œæ¥­çµ±è¨ˆ
- ç¸½ä½œæ¥­æ•¸é‡
- å„ç‹€æ…‹ä½œæ¥­æ•¸é‡
- å¹³å‡å®Œæˆç‡
- ä½œæ¥­æ•ˆç‡åˆ†æ

### 2. å®Œæˆç‡åˆ†æ
- æŒ‰å…¬å¸çµ±è¨ˆå®Œæˆç‡
- æŒ‰ä½œæ¥­é¡å‹çµ±è¨ˆå®Œæˆç‡
- æŒ‰æ™‚é–“æ®µçµ±è¨ˆå®Œæˆç‡
- å®Œæˆç‡è¶¨å‹¢åˆ†æ

### 3. æ•ˆç‡åˆ†æ
- ä½œæ¥­æ™‚é•·çµ±è¨ˆ
- ä½œæ¥­å“¡æ•ˆç‡åˆ†æ
- è¨­å‚™åˆ©ç”¨ç‡åˆ†æ
- ç“¶é ¸å·¥åºè­˜åˆ¥

## ğŸ”’ å®‰å…¨èˆ‡æ¬Šé™

### 1. è³‡æ–™éš”é›¢
- å…¬å¸ç´šåˆ¥çš„è³‡æ–™éš”é›¢
- ç”¨æˆ¶åªèƒ½æŸ¥çœ‹æ‰€å±¬å…¬å¸çš„è³‡æ–™
- è·¨å…¬å¸è³‡æ–™è¨ªå•é™åˆ¶

### 2. æ“ä½œæ¬Šé™
- ä½œæ¥­å»ºç«‹æ¬Šé™
- ä½œæ¥­ä¿®æ”¹æ¬Šé™
- ä½œæ¥­åˆªé™¤æ¬Šé™
- æ­·å²è¨˜éŒ„æŸ¥çœ‹æ¬Šé™

### 3. å¯©è¨ˆè¿½è¹¤
- æ‰€æœ‰æ“ä½œéƒ½æœ‰æ­·å²è¨˜éŒ„
- æ“ä½œè€…èº«ä»½è¿½è¹¤
- IPä½å€è¨˜éŒ„
- è®Šæ›´å…§å®¹è¨˜éŒ„

## ğŸš€ æœªä¾†æ“´å±•

### 1. è¨ˆåŠƒåŠŸèƒ½
- ä½œæ¥­æ’ç¨‹åŠŸèƒ½
- è³‡æºåˆ†é…å„ªåŒ–
- é æ¸¬æ€§ç¶­è­·
- æ™ºèƒ½ä½œæ¥­å»ºè­°

### 2. æ•´åˆåŠŸèƒ½
- èˆ‡ ERP ç³»çµ±æ•´åˆ
- èˆ‡ WMS ç³»çµ±æ•´åˆ
- èˆ‡ QMS ç³»çµ±æ•´åˆ
- èˆ‡è¨­å‚™ç›£æ§ç³»çµ±æ•´åˆ

### 3. åˆ†æåŠŸèƒ½
- å¤§æ•¸æ“šåˆ†æ
- æ©Ÿå™¨å­¸ç¿’é æ¸¬
- æ•ˆèƒ½å„ªåŒ–å»ºè­°
- ç•°å¸¸æª¢æ¸¬

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡æˆ–é–‹ç™¼åœ˜éšŠã€‚ 