# 工單模組重複資料表清理報告

## 📊 清理概覽

本報告詳細列出工單模組中需要清理的重複資料表，確保每個功能模組的獨立性和資料一致性。

## 🚫 需要清理的重複資料表

### 1. 主模組 models.py 中的重複資料表

#### 1.1 DispatchLog (第425行)
- **重複位置**：workorder_dispatch 子模組
- **清理原因**：與 workorder_dispatch 子模組功能重複
- **建議動作**：從主模組 models.py 中移除，使用子模組中的版本

#### 1.2 CompletedWorkOrder (第606行)
- **應屬位置**：workorder_completed_workorder 子模組
- **清理原因**：已完工工單功能應獨立於子模組
- **建議動作**：移至 workorder_completed_workorder/models.py

#### 1.3 CompletedWorkOrderProcess (第670行)
- **應屬位置**：workorder_completed_workorder 子模組
- **清理原因**：已完工工單工序功能應獨立於子模組
- **建議動作**：移至 workorder_completed_workorder/models.py

#### 1.4 CompletedProductionReport (第715行)
- **應屬位置**：workorder_completed_workorder 子模組
- **清理原因**：已完工生產報表功能應獨立於子模組
- **建議動作**：移至 workorder_completed_workorder/models.py

#### 1.5 AutoAllocationSettings (第769行)
- **應屬位置**：workorder_completed_workorder 子模組
- **清理原因**：自動分配設定功能應獨立於子模組
- **建議動作**：移至 workorder_completed_workorder/models.py

#### 1.6 AutoAllocationLog (第930行)
- **應屬位置**：workorder_completed_workorder 子模組
- **清理原因**：自動分配日誌功能應獨立於子模組
- **建議動作**：移至 workorder_completed_workorder/models.py

## 📋 保留的主模組資料表

### 核心工單資料表（統一資料來源）
1. **WorkOrder** - 工單主表（統一資料來源）
2. **WorkOrderProcess** - 工單工序明細
3. **WorkOrderProcessLog** - 工單工序日誌
4. **WorkOrderAssignment** - 工單分配記錄
5. **WorkOrderProcessCapacity** - 工序產能設定
6. **WorkOrderProduction** - 生產中工單
7. **WorkOrderProductionDetail** - 生產報工明細
8. **AutoManagementConfig** - 自動管理配置
9. **ConsistencyCheckResult** - 一致性檢查結果

## 🔄 子模組資料表確認

### workorder_dispatch 子模組
- ✅ WorkOrderDispatch - 派工單主表
- ✅ WorkOrderDispatchProcess - 派工單工序
- ✅ DispatchHistory - 派工歷史記錄

### workorder_completed_workorder 子模組
- ❌ 缺少已完工工單相關資料表（需要從主模組移入）

### workorder_fill_work 子模組
- ❌ 缺少填報作業資料表

### workorder_onsite_report 子模組
- ❌ 缺少現場報工相關資料表

### mes_workorder_operation 子模組
- ❌ 缺少MES工單作業相關資料表

## 📝 清理實施計劃

### 階段1：資料表遷移
1. 將 CompletedWorkOrder 相關資料表遷移至 workorder_completed_workorder 子模組
2. 將 AutoAllocationSettings 和 AutoAllocationLog 遷移至 workorder_completed_workorder 子模組
3. 移除主模組中的 DispatchLog（使用子模組版本）

### 階段2：子模組完善
1. 建立 workorder_fill_work 子模組的資料表
2. 建立 workorder_onsite_report 子模組的資料表
3. 建立 mes_workorder_operation 子模組的資料表

### 階段3：關聯更新
1. 更新所有相關的 views.py 中的 import 語句
2. 更新 admin.py 中的註冊
3. 更新 forms.py 中的表單定義
4. 更新 urls.py 中的路由配置

## ⚠️ 注意事項

1. **資料庫遷移**：清理前需要建立資料庫遷移檔案
2. **關聯檢查**：確保所有外鍵關聯正確更新
3. **功能測試**：清理後需要全面測試所有功能
4. **備份資料**：清理前務必備份重要資料

## 📊 清理效益

1. **模組獨立性**：每個子模組功能獨立，便於維護
2. **資料一致性**：避免重複資料表造成的資料不一致
3. **開發效率**：清晰的模組結構提高開發效率
4. **系統穩定性**：減少資料表衝突，提高系統穩定性 