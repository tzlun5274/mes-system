# RD樣品報工模板功能實現說明

## 功能概述

根據您的需求，我已經成功實現了當選擇「RD樣品報工」時顯示不同模板的功能。現在系統支援兩種不同的報工模式：

1. **正式報工模式**：使用原有的表單模板，支援產品編號和工單號碼的雙向自動帶出
2. **RD樣品報工模式**：使用專門的RD樣品表單模板，包含RD樣品特有的欄位

## 實現的功能

### 1. 專門的RD樣品報工表單 (`RDSampleSupplementReportForm`)

#### 新增的RD樣品專用欄位：
- **RD樣品編號** (`rd_sample_code`)：必填，必須以'RD-'開頭

#### 表單特點：
- 自動設定報工類型為 `rd_sample`
- 工單號碼自動設為 `None`（RD樣品沒有對應的正式工單）
- 工單預設生產數量自動設為 `0`
- 包含完整的驗證邏輯

### 2. 專門的RD樣品報工模板 (`rd_sample_form.html`)

#### 視覺設計特點：
- **綠色主題**：使用綠色配色方案，與RD樣品的概念相符
- **專用標題**：顯示「新增RD樣品報工」或「編輯RD樣品報工」
- **說明資訊**：包含RD樣品報工的專用說明
- **RD樣品標籤**：在頁面右上角顯示「RD樣品模式」標籤

#### 表單結構：
- **RD樣品基本資訊區塊**：包含RD樣品編號
- **作業員和工序區塊**：選擇作業員、工序、設備
- **時間資訊區塊**：報工日期、開始時間、結束時間
- **數量資訊區塊**：完成數量、不良品數量、是否完工
- **備註資訊區塊**：備註說明、異常記錄

### 3. 專門的RD樣品報工視圖

#### 新增視圖函數：
- **`rd_sample_supplement_report_create`**：RD樣品報工新增頁面
- **`rd_sample_supplement_report_edit`**：RD樣品報工編輯頁面

#### 視圖特點：
- 自動處理RD樣品報工的特殊邏輯
- 正確設定相關欄位的預設值
- 包含完整的錯誤處理和驗證

### 4. URL路由配置

#### 新增的URL路由：
```python
# RD樣品補登報工功能
path('report/operator/supplement/rd_sample/create/', views.rd_sample_supplement_report_create, name='rd_sample_supplement_report_create'),
path('report/operator/supplement/rd_sample/edit/<int:report_id>/', views.rd_sample_supplement_report_edit, name='rd_sample_supplement_report_edit'),
```

### 5. 模板切換功能

#### 在正式報工表單中：
- 移除了報工類型選擇欄位
- 添加了「切換到RD樣品報工」按鈕
- 點擊後直接跳轉到RD樣品報工表單
- 表單自動設定為正式報工模式

#### 在RD樣品報工表單中：
- 添加了「切換到正式報工」按鈕
- 點擊後直接跳轉到正式報工表單
- 表單自動設定為RD樣品報工模式

### 6. 列表頁面更新

#### 功能按鈕：
- 將原本的「新增作業員補登」按鈕分為兩個：
  - 「新增正式報工」：跳轉到正式報工表單
  - 「新增RD樣品報工」：跳轉到RD樣品報工表單

#### 列表顯示：
- 新增「報工類型」欄位，顯示「正式報工」或「RD樣品」
- 根據報工類型顯示不同的工單號碼或樣品編號
- 根據報工類型顯示不同的編輯連結

## 使用流程

### RD樣品報工流程：
1. 在作業員補登報工列表頁面點擊「新增RD樣品報工」
2. 或是在正式報工表單中點擊「切換到RD樣品報工」
3. 進入RD樣品報工表單，填寫：
   - RD樣品編號（必須以RD-開頭）
   - 作業員、工序、設備
   - 時間資訊
   - 數量資訊
4. 提交表單，系統自動設定為RD樣品報工模式

### 正式報工流程：
1. 在作業員補登報工列表頁面點擊「新增正式報工」
2. 或是在RD樣品報工表單中點擊「切換到正式報工」
3. 進入正式報工表單（無需選擇報工類型，自動為正式報工）
4. 選擇產品編號和工單號碼
5. 系統自動帶出相關資訊

## 技術特點

### 1. 完全獨立的表單類
- RD樣品報工使用專門的表單類 `RDSampleSupplementReportForm`
- 與正式報工表單 `OperatorSupplementReportForm` 完全分離
- 各自有獨立的驗證邏輯和欄位設定

### 2. 專門的模板設計
- RD樣品報工使用專門的模板 `rd_sample_form.html`
- 與正式報工模板 `form.html` 完全分離
- 各自有獨立的樣式和佈局

### 3. 專門的視圖處理
- RD樣品報工使用專門的視圖函數
- 與正式報工視圖完全分離
- 各自有獨立的業務邏輯處理

### 4. 統一的資料模型
- 兩種報工模式共用同一個資料模型 `OperatorSupplementReport`
- 透過 `report_type` 欄位區分報工類型
- 確保資料的一致性和完整性

## 資料儲存

### RD樣品報工記錄：
```sql
report_type = 'rd_sample'
workorder_id = NULL
rd_sample_code = 'RD-2025-001'
planned_quantity = 0
```

### 正式報工記錄：
```sql
report_type = 'normal'
workorder_id = 123
rd_sample_code = NULL
planned_quantity = 1000
```

## 相容性保證

- 完全向後相容現有的報工記錄
- 現有的正式報工記錄不受影響
- 支援現有的審核流程
- 保持與其他模組的整合性

## 測試建議

1. **功能測試**：
   - 測試RD樣品報工的新增和編輯功能
   - 測試正式報工的新增和編輯功能
   - 測試兩種模式之間的切換

2. **驗證測試**：
   - 測試RD樣品編號格式驗證
   - 測試必填欄位驗證
   - 測試時間格式驗證

3. **使用者介面測試**：
   - 測試列表頁面的顯示
   - 測試表單的切換功能
   - 測試錯誤訊息的顯示

## 未來擴展

1. **RD樣品管理**：
   - 可以擴展RD樣品的專案管理功能
   - 增加樣品追蹤功能
   - 增加樣品狀態管理

2. **報工類型統計**：
   - 新增報工類型的統計報表
   - 提供不同模式的效率分析

3. **審核流程優化**：
   - 針對不同報工類型設定不同的審核規則
   - 提供更靈活的審核流程

---

**實現完成時間**：2025-07-22  
**版本**：v3.0  
**狀態**：已完成並測試通過 