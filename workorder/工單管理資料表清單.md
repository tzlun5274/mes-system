# 工單管理資料表清單

## 📋 總覽

工單管理系統包含 **7個主要子模組**，總共 **20個資料表**，涵蓋了從ERP同步、工單管理、派工管理到填報管理的完整流程。

## 🏗️ 資料表結構詳解

### 1. 工單管理主模組 (workorder)
**資料表數量：9個**

#### 核心工單資料表
- **`workorder_workorder`** - 工單主表（統一資料來源）
  - 功能：記錄工單基本資訊、狀態、數量等
  - 關鍵欄位：公司代號、工單號碼、產品編號、數量、狀態
  - 唯一識別：公司代號 + 工單號碼 + 產品編號

#### 工序管理資料表
- **`workorder_workorderprocess`** - 工單工序明細
  - 功能：記錄工單的工序步驟和執行狀態
  - 關鍵欄位：工序名稱、步驟順序、分配設備、分配作業員

- **`workorder_workorderprocesslog`** - 工單工序日誌
  - 功能：記錄工序執行過程的日誌
  - 關鍵欄位：操作類型、操作時間、操作人員

#### 分配管理資料表
- **`workorder_assignment`** - 工單分配
  - 功能：記錄工單分配給作業員和設備的資訊
  - 關鍵欄位：分配時間、分配人員、分配設備

- **`workorder_process_capacity`** - 工序產能設定
  - 功能：設定各工序的產能限制
  - 關鍵欄位：工序名稱、產能上限、時間設定

#### 生產管理資料表
- **`workorder_production`** - 生產中工單
  - 功能：記錄正在生產中的工單狀態
  - 關鍵欄位：生產狀態、開始時間、預計完成時間

- **`workorder_production_detail`** - 生產報工明細
  - 功能：記錄生產過程中的詳細報工記錄
  - 關鍵欄位：報工時間、合格品數量、不良品數量、作業員

#### 系統管理資料表
- **`workorder_auto_management_config`** - 自動管理配置
  - 功能：系統自動化管理設定
  - 關鍵欄位：配置項目、設定值、啟用狀態

- **`workorder_consistency_check_result`** - 一致性檢查結果
  - 功能：記錄資料一致性檢查結果
  - 關鍵欄位：檢查項目、檢查結果、檢查時間

### 2. 公司製令單子模組 (workorder_companyorder)
**資料表數量：4個**

- **`workorder_companyorder`** - 公司製令單
  - 功能：記錄公司製令單基本資訊
  - 關鍵欄位：公司代號、製令單號、產品編號

- **`workorder_companyorder_erp_systemconfig`** - 公司製令單ERP系統配置
  - 功能：ERP系統連線配置
  - 關鍵欄位：公司代號、ERP連線設定

- **`workorder_companyorder_erp_prdmkordmain`** - 公司製令單ERP製令主檔
  - 功能：ERP製令主檔資料
  - 關鍵欄位：製令單號、產品資訊、數量

- **`workorder_companyorder_erp_prdmkordmats`** - 公司製令單ERP製令明細
  - 功能：ERP製令明細資料
  - 關鍵欄位：製令單號、物料資訊、用量

### 3. MES工單作業子模組 (mes_workorder_operation)
**資料表數量：3個**

- **`mes_workorder_operation`** - MES工單作業主表
  - 功能：記錄MES工單作業基本資訊
  - 關鍵欄位：工單號碼、作業狀態、開始時間

- **`mes_workorder_operation_detail`** - MES工單作業明細
  - 功能：記錄MES工單作業詳細資訊
  - 關鍵欄位：作業項目、完成數量、作業員

- **`mes_workorder_operation_history`** - MES工單作業歷史
  - 功能：記錄MES工單作業歷史記錄
  - 關鍵欄位：作業時間、作業內容、操作人員

### 4. 派工單子模組 (workorder_dispatch)
**資料表數量：3個**

- **`workorder_dispatch`** - 派工單主表
  - 功能：記錄派工單基本資訊
  - 關鍵欄位：派工單號、工單號碼、派工狀態

- **`workorder_dispatch_process`** - 派工單工序
  - 功能：記錄派工單的工序資訊
  - 關鍵欄位：工序名稱、分配設備、分配作業員

- **`workorder_dispatch_history`** - 派工歷史記錄
  - 功能：記錄派工歷史記錄
  - 關鍵欄位：派工時間、派工內容、操作人員

### 5. 填報作業子模組 (workorder_fill_work)
**資料表數量：1個**

- **`workorder_fill_work`** - 填報作業
  - 功能：記錄填報作業資訊
  - 關鍵欄位：工單號碼、作業員、工作時間、完成數量

### 6. 已完工工單子模組 (workorder_completed_workorder)
**資料表數量：5個**

- **`workorder_completed_workorder`** - 已完工工單
  - 功能：記錄已完成生產的工單資訊
  - 關鍵欄位：完工時間、實際完成數量、總工時

- **`workorder_completed_workorder_process`** - 已完工工單工序
  - 功能：記錄已完工工單的工序資訊
  - 關鍵欄位：工序名稱、完成時間、完成數量

- **`workorder_completed_production_report`** - 已完工生產報表
  - 功能：記錄已完工生產報表
  - 關鍵欄位：報表日期、生產數量、品質狀況

- **`workorder_auto_allocation_settings`** - 自動分配設定
  - 功能：自動分配相關設定
  - 關鍵欄位：分配規則、啟用狀態

- **`workorder_auto_allocation_log`** - 自動分配日誌
  - 功能：記錄自動分配日誌
  - 關鍵欄位：分配時間、分配結果、分配原因

### 7. 現場報工子模組 (workorder_onsite_report)
**資料表數量：4個**

- **`workorder_onsite_report`** - 現場報工記錄
  - 功能：記錄現場報工資訊
  - 關鍵欄位：工單號碼、作業員、報工時間、完成數量

- **`workorder_onsite_report_session`** - 現場報工工作時段
  - 功能：記錄現場報工工作時段
  - 關鍵欄位：開始時間、結束時間、工作時數

- **`workorder_onsite_report_history`** - 現場報工歷史記錄
  - 功能：記錄現場報工歷史記錄
  - 關鍵欄位：報工時間、報工內容、操作人員

- **`workorder_onsite_report_config`** - 現場報工配置
  - 功能：現場報工相關配置
  - 關鍵欄位：配置項目、設定值、啟用狀態

## 🔗 資料關聯關係

### 生產監控關聯
1. **工序紀錄來源**：現場報工資料 (`workorder_onsite_report`)
2. **填報紀錄來源**：填報管理 (`workorder_fill_work`)
3. **派工單工序**：與現場報工關聯 (`workorder_dispatch_process` ↔ `workorder_onsite_report`)
4. **工單詳情工序紀錄**：與現場報工關聯 (`workorder_workorderprocess` ↔ `workorder_onsite_report`)
5. **工單詳情填報紀錄**：與填報管理關聯 (`workorder_workorder` ↔ `workorder_fill_work`)
6. **完工判斷**：以工序紀錄跟填報紀錄合併計算

### 多公司架構關聯
- 所有資料表都支援公司代號欄位
- 資料隔離透過公司代號實現
- 唯一識別：公司代號 + 工單號碼 + 產品編號

## 📊 資料表統計

| 子模組 | 資料表數量 | 主要功能 |
|--------|------------|----------|
| 工單管理主模組 | 9個 | 核心工單管理 |
| 公司製令單子模組 | 4個 | ERP資料同步 |
| MES工單作業子模組 | 3個 | MES作業管理 |
| 派工單子模組 | 3個 | 派工管理 |
| 填報作業子模組 | 1個 | 填報管理 |
| 已完工工單子模組 | 5個 | 完工管理 |
| 現場報工子模組 | 4個 | 現場報工 |
| **總計** | **29個** | **完整工單管理** |

## ⚠️ 注意事項

### 1. 資料表命名規範
- 所有資料表名稱使用小寫、單數形式、底線分隔
- 欄位名稱使用小寫、底線分隔
- 主鍵統一命名為 `id`

### 2. 多公司架構
- 所有資料表都必須支援公司代號欄位
- 查詢時必須包含公司代號條件
- 確保不同公司資料完全隔離

### 3. 唯一性識別
- 工單唯一識別：公司代號 + 工單號碼 + 產品編號
- 所有相關查詢都必須使用完整識別碼
- 避免跨公司資料混淆

### 4. 資料完整性
- 建立適當的外鍵關聯
- 實施資料驗證規則
- 確保資料一致性

## 📝 維護建議

### 1. 定期檢查
- 定期檢查資料表結構完整性
- 監控資料表效能
- 檢查資料一致性

### 2. 備份策略
- 定期備份重要資料
- 建立資料恢復機制
- 測試備份資料完整性

### 3. 效能優化
- 建立適當的索引
- 優化查詢語句
- 監控資料庫效能

### 4. 安全控制
- 實施適當的權限控制
- 記錄資料操作日誌
- 定期安全檢查 