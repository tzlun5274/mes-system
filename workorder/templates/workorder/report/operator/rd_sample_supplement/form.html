{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if supplement_report %}編輯備用作業員RD樣品補登報工{% else %}新增備用作業員RD樣品補登報工{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* 表單卡片樣式 */
    .operator-supplement-form-card {
        transition: all 0.3s ease;
        border: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        background: #ffffff;
    }
    
    /* 表單區塊樣式 */
    .form-section {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid #e9ecef;
    }
    
    .form-section h6 {
        color: #495057;
        margin-bottom: 15px;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 8px;
        font-weight: 600;
    }
    
    /* 說明文字樣式 */
    .help-text {
        font-size: 0.875rem;
        color: #495057 !important;
        margin-top: 0.25rem;
        font-weight: 500;
        line-height: 1.4;
        display: block;
    }
    
    /* 錯誤文字樣式 */
    .error-text {
        font-size: 0.875rem;
        color: #dc3545 !important;
        margin-top: 0.25rem;
        font-weight: 500;
        display: block;
    }
    
    /* 表單標籤樣式 */
    .form-label {
        color: #212529 !important;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    /* 輸入框樣式 */
    .form-control {
        border-color: #ced4da;
        color: #495057;
        background-color: #ffffff;
    }
    
    .form-control:focus {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        color: #495057;
    }
    
    /* Messages 樣式 */
    .messages-container {
        margin-bottom: 1.5rem;
    }
    
    .messages-container .alert {
        border-radius: 8px;
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-weight: 500;
        padding: 1rem 1.25rem;
    }
    
    .messages-container .alert-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border-left: 4px solid #28a745;
    }
    
    .messages-container .alert-error {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border-left: 4px solid #dc3545;
    }
    
    .messages-container .alert-warning {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
        border-left: 4px solid #ffc107;
    }
    
    .messages-container .alert-info {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
        border-left: 4px solid #17a2b8;
    }
    
    .messages-container .alert i {
        margin-right: 0.5rem;
        font-size: 1.1rem;
    }
    
    .messages-container .btn-close {
        opacity: 0.7;
        transition: opacity 0.3s ease;
    }
    
    .messages-container .btn-close:hover {
        opacity: 1;
    }
    
    /* 卡片標題樣式 - 強制覆蓋Bootstrap */
    .operator-supplement-form-card .card-header,
    .operator-supplement-form-card .card-header.bg-light {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
        border-bottom: 3px solid #004085 !important;
        padding: 0 !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        border-radius: 8px 8px 0 0 !important;
        color: #ffffff !important;
    }
    
    .operator-supplement-form-card .card-header h5,
    .operator-supplement-form-card .card-header h5.mb-0 {
        color: #ffffff !important;
        font-weight: 700 !important;
        font-size: 1.25rem !important;
        text-align: left !important;
        padding: 15px 20px !important;
        margin: 0 !important;
        background: transparent !important;
        border-radius: 8px 8px 0 0 !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5) !important;
        border: none !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    /* 標題欄按鈕樣式 - 強制覆蓋Bootstrap */
    .operator-supplement-form-card .card-header .btn-success,
    .operator-supplement-form-card .card-header .btn-success.btn-sm {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important;
        border: 2px solid #ffffff !important;
        color: #ffffff !important;
        font-weight: 600 !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3) !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
        border-radius: 6px !important;
    }
    
    .operator-supplement-form-card .card-header .btn-success:hover,
    .operator-supplement-form-card .card-header .btn-success.btn-sm:hover {
        background: linear-gradient(135deg, #218838 0%, #1c7430 100%) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3) !important;
        color: #ffffff !important;
    }
    
    /* 確保標題欄容器樣式 */
    .operator-supplement-form-card .card-header .d-flex {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
        border-radius: 8px 8px 0 0 !important;
        padding: 0 !important;
    }
    
    /* 強制確保標題文字可見 */
    .operator-supplement-form-card .card-header h5,
    .operator-supplement-form-card .card-header h5.mb-0,
    .operator-supplement-form-card .card-header h5 * {
        color: #ffffff !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5) !important;
        font-weight: 700 !important;
        z-index: 10 !important;
        position: relative !important;
    }
    
    /* 確保圖標也可見 */
    .operator-supplement-form-card .card-header h5 i {
        color: #ffffff !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5) !important;
    }
    
    /* 強制覆蓋任何可能的背景色衝突 */
    .operator-supplement-form-card .card-header,
    .operator-supplement-form-card .card-header.bg-light,
    .operator-supplement-form-card .card-header * {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
        background-color: #007bff !important;
    }
    
    /* 確保整個標題區域都是藍色背景 */
    .operator-supplement-form-card .card-header .d-flex {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
        background-color: #007bff !important;
        border-radius: 8px 8px 0 0 !important;
        padding: 0 !important;
        color: #ffffff !important;
    }
    

    
    /* 時間選擇器樣式 */
    .time-picker-container {
        position: absolute;
        background: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
        display: none;
        padding: 10px;
        min-width: 200px;
    }
    
    .time-picker-container select {
        width: 80px;
        display: inline-block;
        margin-right: 10px;
    }
    
    .time-picker-container button {
        margin-left: 5px;
    }
    
    /* 強制覆蓋Bootstrap的響應式樣式 */
    @media (max-width: 768px) {
        .time-select-group {
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: nowrap !important;
        }
        
        .time-hour-select, .time-minute-select {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
            display: inline-block !important;
            float: none !important;
        }
    }
    
    /* 唯讀欄位樣式 */
    .form-control[readonly] {
        background-color: #f8f9fa;
        color: #6c757d;
        cursor: not-allowed;
    }
    
    /* 必填欄位標記 */
    .required-field {
        color: #dc3545;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 頁面標題 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-0">
                        <i class="fas fa-flask text-warning"></i> 
                        {% if supplement_report %}編輯備用作業員RD樣品補登報工{% else %}新增備用作業員RD樣品補登報工{% endif %}
                    </h2>
                    <p class="text-muted mb-0">
                        {% if supplement_report %}
                            修改備用作業員RD樣品補登報工記錄的詳細資訊
                        {% else %}
                            建立新的備用作業員RD樣品補登報工記錄
                        {% endif %}
                    </p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{% url 'workorder:operator_supplement_report_create' %}" class="btn btn-warning">
                        <i class="fas fa-plus"></i> 新增備用作業員補登報工
                    </a>
                    <a href="{% url 'workorder:operator_supplement_report_index' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> 返回備用作業員補登報工列表
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 表單區域 -->
    <div class="row">
        <div class="col-12">
            <div class="card operator-supplement-form-card">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-flask"></i> 
                            {% if supplement_report %}編輯RD樣品補登記錄{% else %}新增RD樣品補登記錄{% endif %}
                        </h5>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Django Messages 顯示區域 -->
                    {% if messages %}
                        <div class="messages-container mb-4">
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-triangle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <form method="post" id="operator_rd_sample_supplement_form">
                        {% csrf_token %}
                        

                        <!-- RD樣品資訊區塊 -->
                        <div class="form-section">
                            <h6><i class="fas fa-flask"></i> RD樣品資訊</h6>

                            <!-- 產品編號和工單號碼欄位 -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.product_id.id_for_label }}" class="form-label">
                                            RD產品編號 <span class="required-field">*</span>
                                        </label>
                                        {{ form.product_id }}
                                        {% if form.product_id.help_text %}
                                            <div class="help-text">{{ form.product_id.help_text }}</div>
                                        {% endif %}
                                        {% if form.product_id.errors %}
                                            <div class="error-text">{{ form.product_id.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.original_workorder_number.id_for_label }}" class="form-label">
                                            RD工單號碼
                                        </label>
                                        {{ form.original_workorder_number }}
                                        {% if form.original_workorder_number.help_text %}
                                            <div class="help-text">{{ form.original_workorder_number.help_text }}</div>
                                        {% endif %}
                                        {% if form.original_workorder_number.errors %}
                                            <div class="error-text">{{ form.original_workorder_number.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.operator.id_for_label }}" class="form-label">
                                            作業員 <span class="required-field">*</span>
                                        </label>
                                        {{ form.operator }}
                                        {% if form.operator.help_text %}
                                            <div class="help-text">{{ form.operator.help_text }}</div>
                                        {% endif %}
                                        {% if form.operator.errors %}
                                            <div class="error-text">{{ form.operator.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.process.id_for_label }}" class="form-label">
                                            工序 <span class="required-field">*</span>
                                        </label>
                                        {{ form.process }}
                                        {% if form.process.help_text %}
                                            <div class="help-text">{{ form.process.help_text }}</div>
                                        {% endif %}
                                        {% if form.process.errors %}
                                            <div class="error-text">{{ form.process.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.equipment.id_for_label }}" class="form-label">
                                            設備
                                        </label>
                                        {{ form.equipment }}
                                        {% if form.equipment.help_text %}
                                            <div class="help-text">{{ form.equipment.help_text }}</div>
                                        {% endif %}
                                        {% if form.equipment.errors %}
                                            <div class="error-text">{{ form.equipment.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 數量資訊區塊 -->
                        <div class="form-section">
                            <h6><i class="fas fa-chart-line"></i> 數量資訊</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.planned_quantity.id_for_label }}" class="form-label">
                                            工單預設生產數量
                                        </label>
                                        {{ form.planned_quantity }}
                                        <div class="help-text">此為工單規劃的總生產數量，不可修改</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.work_quantity.id_for_label }}" class="form-label">
                                            工作數量 <span class="required-field">*</span>
                                        </label>
                                        {{ form.work_quantity }}
                                        {% if form.work_quantity.help_text %}
                                            <div class="help-text">{{ form.work_quantity.help_text }}</div>
                                        {% endif %}
                                        {% if form.work_quantity.errors %}
                                            <div class="error-text">{{ form.work_quantity.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.defect_quantity.id_for_label }}" class="form-label">
                                            不良品數量
                                        </label>
                                        {{ form.defect_quantity }}
                                        {% if form.defect_quantity.errors %}
                                            <div class="error-text">{{ form.defect_quantity.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 時間資訊區塊 -->
                        <div class="form-section">
                            <h6><i class="fas fa-clock"></i> 時間資訊</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.work_date.id_for_label }}" class="form-label">
                                            日期 <span class="required-field">*</span>
                                        </label>
                                        {{ form.work_date }}
                                        {% if form.work_date.help_text %}
                                            <div class="help-text">{{ form.work_date.help_text }}</div>
                                        {% endif %}
                                        {% if form.work_date.errors %}
                                            <div class="error-text">{{ form.work_date.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.start_time.id_for_label }}" class="form-label">
                                            開始時間 <span class="required-field">*</span>
                                        </label>
                                        {{ form.start_time }}
                                        {% if form.start_time.help_text %}
                                            <div class="help-text">{{ form.start_time.help_text }}</div>
                                        {% endif %}
                                        {% if form.start_time.errors %}
                                            <div class="error-text">{{ form.start_time.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.end_time.id_for_label }}" class="form-label">
                                            結束時間 <span class="required-field">*</span>
                                        </label>
                                        {{ form.end_time }}
                                        {% if form.end_time.help_text %}
                                            <div class="help-text">{{ form.end_time.help_text }}</div>
                                        {% endif %}
                                        {% if form.end_time.errors %}
                                            <div class="error-text">{{ form.end_time.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 休息時間相關功能已移除，系統完全在後端計算 -->
                            
                        </div>

                        <!-- 狀態與備註區塊 -->
                        <div class="form-section">
                            <h6><i class="fas fa-check-circle"></i> 狀態與備註</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <div class="form-check">
                                            {{ form.is_completed }}
                                            <label class="form-check-label" for="{{ form.is_completed.id_for_label }}">
                                                {{ form.is_completed.label }}
                                            </label>
                                        </div>
                                        {% if form.is_completed.help_text %}
                                            <div class="help-text">{{ form.is_completed.help_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.completion_method.id_for_label }}" class="form-label">
                                            完工判斷方式
                                        </label>
                                        {{ form.completion_method }}
                                        {% if form.completion_method.help_text %}
                                            <div class="help-text">{{ form.completion_method.help_text }}</div>
                                        {% endif %}
                                        {% if form.completion_method.errors %}
                                            <div class="error-text">{{ form.completion_method.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.remarks.id_for_label }}" class="form-label">
                                            備註
                                        </label>
                                        {{ form.remarks }}
                                        {% if form.remarks.help_text %}
                                            <div class="help-text">{{ form.remarks.help_text }}</div>
                                        {% endif %}
                                        {% if form.remarks.errors %}
                                            <div class="error-text">{{ form.remarks.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.abnormal_notes.id_for_label }}" class="form-label">
                                            異常記錄
                                        </label>
                                        {{ form.abnormal_notes }}
                                        {% if form.abnormal_notes.help_text %}
                                            <div class="help-text">{{ form.abnormal_notes.help_text }}</div>
                                        {% endif %}
                                        {% if form.abnormal_notes.errors %}
                                            <div class="error-text">{{ form.abnormal_notes.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <!-- 核准狀態欄位已隱藏，預設為待核准 -->
                                    <input type="hidden" name="{{ form.approval_status.name }}" value="pending">
                                </div>
                            </div>
                        </div>

                        <!-- 按鈕區域 -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-end gap-2">
                                    <a href="{% url 'workorder:operator_supplement_report_index' %}" class="btn btn-secondary">
                                        <i class="fas fa-times"></i> 取消
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> 
                                        {% if supplement_report %}更新{% else %}儲存{% endif %}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== 作業員RD樣品補登報工表單初始化 ===');
    
    // 全域變數
    
    // ==================== RD樣品報工表單 JavaScript ====================
    
    // 創建時間選擇器
    function createTimePicker(inputElement) {
        // 創建時間選擇器容器
        const pickerContainer = document.createElement('div');
        pickerContainer.className = 'time-picker-container';
        
        // 創建小時選擇器
        const hourSelect = document.createElement('select');
        hourSelect.className = 'form-control mb-2';
        
        for (let i = 0; i < 24; i++) {
            const option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.textContent = i.toString().padStart(2, '0');
            hourSelect.appendChild(option);
        }
        
        // 創建分鐘選擇器
        const minuteSelect = document.createElement('select');
        minuteSelect.className = 'form-control mb-2';
        
        for (let i = 0; i < 60; i += 5) {
            const option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.textContent = i.toString().padStart(2, '0');
            minuteSelect.appendChild(option);
        }
        
        // 創建確定按鈕
        const confirmBtn = document.createElement('button');
        confirmBtn.type = 'button';
        confirmBtn.className = 'btn btn-primary btn-sm';
        confirmBtn.textContent = '確定';
        
        // 創建取消按鈕
        const cancelBtn = document.createElement('button');
        cancelBtn.type = 'button';
        cancelBtn.className = 'btn btn-secondary btn-sm';
        cancelBtn.textContent = '取消';
        
        // 組裝選擇器
        pickerContainer.appendChild(hourSelect);
        pickerContainer.appendChild(minuteSelect);
        pickerContainer.appendChild(confirmBtn);
        pickerContainer.appendChild(cancelBtn);
        
        // 插入到頁面
        inputElement.parentNode.style.position = 'relative';
        inputElement.parentNode.appendChild(pickerContainer);
        
        // 點擊輸入框顯示選擇器
        inputElement.addEventListener('click', function(e) {
            e.preventDefault();
            pickerContainer.style.display = 'block';
            
            // 設定當前值
            const currentValue = inputElement.value;
            if (currentValue) {
                const [hour, minute] = currentValue.split(':');
                hourSelect.value = hour;
                minuteSelect.value = minute;
            }
        });
        
        // 確定按鈕事件
        confirmBtn.addEventListener('click', function() {
            const timeValue = `${hourSelect.value}:${minuteSelect.value}`;
            inputElement.value = timeValue;
            pickerContainer.style.display = 'none';
        });
        
        // 取消按鈕事件
        cancelBtn.addEventListener('click', function() {
            pickerContainer.style.display = 'none';
        });
        
        // 點擊外部關閉選擇器
        document.addEventListener('click', function(e) {
            if (!pickerContainer.contains(e.target) && e.target !== inputElement) {
                pickerContainer.style.display = 'none';
            }
        });
    }
    
    // 初始化時間選擇器
    const startTimeInput = document.getElementById('{{ form.start_time.id_for_label }}');
    const endTimeInput = document.getElementById('{{ form.end_time.id_for_label }}');
    
    if (startTimeInput) {
        createTimePicker(startTimeInput);
    }
    if (endTimeInput) {
        createTimePicker(endTimeInput);
    }
    
    // 取得DOM元素
    const plannedQuantityInput = document.getElementById('{{ form.planned_quantity.id_for_label }}');
    
    // 除錯：檢查元素是否存在
    console.log('DOM元素檢查:');
    console.log('plannedQuantityInput:', plannedQuantityInput);
    
    // 設定RD樣品預設值
    if (plannedQuantityInput) {
        plannedQuantityInput.value = '0';
    }
    
    // ==================== 表單驗證 ====================
    
    // 表單驗證
    const form = document.getElementById('operator_rd_sample_supplement_form');
    if (form) {
        form.addEventListener('submit', function(e) {
            if (startTimeInput && endTimeInput && startTimeInput.value && endTimeInput.value) {
                // 將時間字串轉換為分鐘數進行比較
                const startTime = startTimeInput.value;
                const endTime = endTimeInput.value;
                
                const startMinutes = parseInt(startTime.split(':')[0]) * 60 + parseInt(startTime.split(':')[1]);
                const endMinutes = parseInt(endTime.split(':')[0]) * 60 + parseInt(endTime.split(':')[1]);
                
                if (endMinutes <= startMinutes) {
                    e.preventDefault();
                    alert('結束時間必須大於開始時間');
                    return false;
                }
            }
            
            const workQuantity = document.getElementById('{{ form.work_quantity.id_for_label }}');
            if (workQuantity && workQuantity.value && parseInt(workQuantity.value) < 0) {
                e.preventDefault();
                alert('工作數量不能為負數');
                return false;
            }
            
            const defectQuantity = document.getElementById('{{ form.defect_quantity.id_for_label }}');
            if (defectQuantity && defectQuantity.value && parseInt(defectQuantity.value) < 0) {
                e.preventDefault();
                alert('不良品數量不能為負數');
                return false;
            }
            
            // 驗證通過，允許表單提交
            return true;
        });
    }
    
    console.log('=== 作業員RD樣品補登報工表單初始化完成 ===');
});
</script>
{% endblock %} 