# 作業員報工範本修正說明

## 問題描述

作業員報工範本存在以下問題：
1. **缺少設備欄位**：範本中沒有設備欄位，但實際報工時可能需要記錄使用的設備
2. **使用 ID 而非名稱**：範本使用作業員ID和工序ID，但使用者只知道名稱，不知道ID
3. **設備驗證過於嚴格**：有些工序不需要設備，但系統會因為找不到設備而報錯

## 修正內容

### 1. 範本欄位調整

#### 修正前
```
公司代號, 報工日期, 開始時間, 結束時間, 作業員ID, 工單號, 工序ID, 
報工數量, 不良品數量, 備註, 報工類型
```

#### 修正後
```
公司代號, 報工日期, 開始時間, 結束時間, 作業員名稱, 工單號, 工序名稱, 
設備名稱, 報工數量, 不良品數量, 備註, 報工類型
```

**變更說明**：
- 新增「設備名稱」欄位
- 「作業員ID」改為「作業員名稱」
- 「工序ID」改為「工序名稱」

### 2. 範例資料更新

#### 修正前
```excel
COMP001, 2024-01-15, 08:00, 12:00, 1, WO-2024-001, 1, 100, 5, 正常生產, 正式報工
COMP001, 2024-01-15, 13:00, 17:00, 2, , 2, 50, 2, RD樣品測試, RD樣品
COMP002, 2024-01-16, 09:00, 17:00, 3, WO-2024-002, 2, 150, 3, 大量生產, 正式報工
```

#### 修正後
```excel
COMP001, 2024-01-15, 08:00, 12:00, 張小明, WO-2024-001, 目檢, 目檢台A, 100, 5, 正常生產, 正式報工
COMP001, 2024-01-15, 13:00, 17:00, 李美玲, , 測試, 測試設備B, 50, 2, RD樣品測試, RD樣品
COMP002, 2024-01-16, 09:00, 17:00, 王大華, WO-2024-002, 包裝, 包裝機C, 150, 3, 大量生產, 正式報工
```

### 3. 匯入邏輯修正

#### 作業員查找邏輯
```python
# 修正前：根據ID查找
operator = Operator.objects.get(id=int(operator_id))

# 修正後：根據名稱查找
operator = Operator.objects.get(name=operator_name)
```

#### 工序查找邏輯
```python
# 修正前：根據ID查找
process = ProcessName.objects.get(id=int(process_id))

# 修正後：根據名稱查找
process = ProcessName.objects.get(name=process_name)
```

#### 設備查找邏輯（新增）
```python
# 新增：根據名稱查找設備（可選）
equipment = None
if equipment_name:
    try:
        equipment = Equipment.objects.get(name=equipment_name)
    except Equipment.DoesNotExist:
        # 設備名稱找不到時，只記錄警告，不中斷處理
        print(f'警告：第 {row} 行找不到設備 {equipment_name}，將使用空值')
        equipment = None
```

### 4. 錯誤處理改善

#### 設備驗證邏輯
- **修正前**：找不到設備時會報錯並中斷處理
- **修正後**：找不到設備時只記錄警告，繼續處理（因為有些工序不需要設備）

#### 錯誤訊息更新
```python
# 修正前
errors.append(f'第 {row} 行：找不到作業員 ID {operator_id}')
errors.append(f'第 {row} 行：找不到工序 ID {process_id}')
errors.append(f'第 {row} 行：找不到設備 {equipment_name}')

# 修正後
errors.append(f'第 {row} 行：找不到作業員 {operator_name}')
errors.append(f'第 {row} 行：找不到工序 {process_name}')
# 設備錯誤改為警告，不中斷處理
```

## 使用方式

### 1. 下載範本
1. 進入作業員補登報工頁面
2. 點擊「下載範本」按鈕
3. 取得 Excel 格式的報工範本

### 2. 填寫範本
- **作業員名稱**：填寫實際的作業員姓名（如：張小明）
- **工序名稱**：填寫實際的工序名稱（如：目檢、測試、包裝）
- **設備名稱**：填寫使用的設備名稱（如：目檢台A），如果沒有設備可留空
- **工單號**：正式報工填寫工單號，RD樣品可留空
- **報工類型**：填寫「正式報工」或「RD樣品」

### 3. 匯入資料
1. 點擊「批量匯入」按鈕
2. 選擇填寫好的 Excel 檔案
3. 系統會自動驗證並匯入資料

## 範例情境

### 情境1：有設備的正式報工
```
公司代號: COMP001
報工日期: 2024-01-15
開始時間: 08:00
結束時間: 12:00
作業員名稱: 張小明
工單號: WO-2024-001
工序名稱: 目檢
設備名稱: 目檢台A
報工數量: 100
不良品數量: 5
備註: 正常生產
報工類型: 正式報工
```

### 情境2：無設備的RD樣品
```
公司代號: COMP001
報工日期: 2024-01-15
開始時間: 13:00
結束時間: 17:00
作業員名稱: 李美玲
工單號: （留空）
工序名稱: 測試
設備名稱: （留空）
報工數量: 50
不良品數量: 2
備註: RD樣品測試
報工類型: RD樣品
```

## 修正效果

1. ✅ **使用者友善**：使用名稱而不是ID，使用者更容易理解
2. ✅ **完整性**：新增設備欄位，記錄更完整的報工資訊
3. ✅ **彈性**：設備欄位可選，支援不需要設備的工序
4. ✅ **容錯性**：找不到設備時不會中斷匯入流程
5. ✅ **一致性**：與系統其他功能保持一致的使用方式

## 注意事項

1. **作業員名稱必須完全匹配**：系統中的作業員名稱必須與範本中的名稱完全一致
2. **工序名稱必須完全匹配**：系統中的工序名稱必須與範本中的名稱完全一致
3. **設備名稱可選**：如果填寫設備名稱，必須與系統中的設備名稱完全一致
4. **工單號格式**：正式報工必須填寫正確的工單號格式
5. **日期時間格式**：日期格式為 YYYY-MM-DD，時間格式為 HH:MM

這個修正讓作業員報工範本更加實用和易用，符合實際的作業需求。 