# ğŸš€ MES ç³»çµ±å…¨æ–°ç”Ÿç”¢ä¸»æ©Ÿéƒ¨ç½²èªªæ˜

## ğŸ“‹ ç›®éŒ„
- [éƒ¨ç½²æ¦‚è¿°](#éƒ¨ç½²æ¦‚è¿°)
- [å…ˆæ±ºæ¢ä»¶](#å…ˆæ±ºæ¢ä»¶)
- [éƒ¨ç½²æ­¥é©Ÿ](#éƒ¨ç½²æ­¥é©Ÿ)
- [é©—è­‰éƒ¨ç½²](#é©—è­‰éƒ¨ç½²)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ç¶­è­·æŒ‡å—](#ç¶­è­·æŒ‡å—)

---

## ğŸ¯ éƒ¨ç½²æ¦‚è¿°

æœ¬æ–‡ä»¶èªªæ˜å¦‚ä½•å°‡ MES ç³»çµ±éƒ¨ç½²åˆ°å…¨æ–°çš„ç”Ÿç”¢ä¸»æ©Ÿä¸Šã€‚éƒ¨ç½²éç¨‹å®Œå…¨è‡ªå‹•åŒ–ï¼Œåªéœ€é…ç½®ç’°å¢ƒè®Šæ•¸å³å¯ã€‚

### ğŸ“Š ç³»çµ±æ¶æ§‹
- **Web ä¼ºæœå™¨**: Nginx + Gunicorn
- **è³‡æ–™åº«**: PostgreSQL
- **å¿«å–/è¨Šæ¯ä½‡åˆ—**: Redis
- **èƒŒæ™¯ä»»å‹™**: Celery Worker + Celery Beat
- **æ‡‰ç”¨æ¡†æ¶**: Django 5.1.8

### ğŸ¯ éƒ¨ç½²ç›®æ¨™
- å°‡ MES ç³»çµ±éƒ¨ç½²åˆ°å…¨æ–°çš„ Ubuntu ä¸»æ©Ÿ
- è‡ªå‹•åŒ–æ‰€æœ‰å®‰è£å’Œé…ç½®æ­¥é©Ÿ
- ç¢ºä¿ç³»çµ±ç©©å®šé‹è¡Œ
- æä¾›å®Œæ•´çš„ç›£æ§å’Œç¶­è­·åŠŸèƒ½

---

## âš™ï¸ å…ˆæ±ºæ¢ä»¶

### ğŸ–¥ï¸ ç¡¬é«”è¦æ±‚
| é …ç›® | æœ€ä½è¦æ±‚ | å»ºè­°é…ç½® |
|------|----------|----------|
| CPU | 2æ ¸å¿ƒ | 4æ ¸å¿ƒä»¥ä¸Š |
| è¨˜æ†¶é«” | 4GB | 8GBä»¥ä¸Š |
| ç¡¬ç¢Ÿ | 20GBå¯ç”¨ç©ºé–“ | 50GBä»¥ä¸Š |
| ç¶²è·¯ | 100Mbps | 1Gbps |

### ğŸ’» ä½œæ¥­ç³»çµ±
- **æ¨è–¦**: Ubuntu 22.04 LTS
- **æ”¯æ´**: Ubuntu 20.04 LTS
- **ä¸æ”¯æ´**: Windows, macOS

### ğŸŒ ç¶²è·¯è¨­å®š
- å›ºå®š IP åœ°å€
- é˜²ç«ç‰†é–‹æ”¾ç«¯å£ï¼š
  - 80 (HTTP)
  - 443 (HTTPSï¼Œå¯é¸)
  - 22 (SSH)

### ğŸ”‘ å¿…è¦è³‡è¨Š
éƒ¨ç½²å‰è«‹æº–å‚™ä»¥ä¸‹è³‡è¨Šï¼š
- ä¸»æ©Ÿ IP åœ°å€
- è³‡æ–™åº«å¯†ç¢¼
- Redis å¯†ç¢¼
- ç®¡ç†å“¡å¯†ç¢¼

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### éšæ®µ 1: æº–å‚™å·¥ä½œ (5åˆ†é˜)

#### 1.1 æ›´æ–°ç³»çµ±
```bash
# æ›´æ–°å¥—ä»¶æ¸…å–®
sudo apt update

# å‡ç´šç³»çµ±å¥—ä»¶
sudo apt upgrade -y

# å®‰è£åŸºç¤å·¥å…·
sudo apt install -y curl wget git unzip lsof net-tools
```

#### 1.2 ä¸‹è¼‰éƒ¨ç½²åŒ…
```bash
# ä¸‹è¼‰éƒ¨ç½²åŒ…ï¼ˆè«‹æ›¿æ›ç‚ºå¯¦éš›çš„URLï¼‰
wget [éƒ¨ç½²åŒ…URL] -O mes_deployment.tar.gz

# è§£å£“ç¸®
tar -xzf mes_deployment.tar.gz

# é€²å…¥éƒ¨ç½²ç›®éŒ„
cd mes_deployment
```

### éšæ®µ 2: ç’°å¢ƒé…ç½® (10åˆ†é˜)

#### 2.1 ç·¨è¼¯ç’°å¢ƒé…ç½®
```bash
# ç·¨è¼¯ç’°å¢ƒé…ç½®æª”æ¡ˆ
nano .env
```

#### 2.2 ä¿®æ”¹é—œéµè¨­å®š
```bash
# å¿…é ˆä¿®æ”¹çš„é …ç›®
HOST_IP=192.168.1.28                    # æ”¹ç‚ºä½ çš„ä¸»æ©ŸIP
DATABASE_PASSWORD=your_secure_password   # è¨­å®šè³‡æ–™åº«å¯†ç¢¼
REDIS_PASSWORD=your_redis_password       # è¨­å®šRediså¯†ç¢¼
SUPERUSER_PASSWORD=your_admin_password   # è¨­å®šç®¡ç†å“¡å¯†ç¢¼
DEBUG=False                              # ç”Ÿç”¢ç’°å¢ƒè¨­ç‚ºFalse

# å¯é¸ä¿®æ”¹é …ç›®
ALLOWED_HOSTS=localhost,127.0.0.1,192.168.1.28  # å…è¨±çš„ä¸»æ©Ÿ
LANGUAGE_CODE=zh-hant                           # èªè¨€è¨­å®š
TIME_ZONE=Asia/Taipei                          # æ™‚å€è¨­å®š
```

#### 2.3 é…ç½®ç¯„ä¾‹
```bash
# .env æª”æ¡ˆç¯„ä¾‹
DJANGO_SECRET_KEY='your-secret-key-here'
DEBUG=False
ALLOWED_HOSTS=localhost,127.0.0.1,192.168.1.28
HOST_IP=192.168.1.28
DATABASE_NAME=mesdb
DATABASE_USER=mes_user
DATABASE_PASSWORD=your_secure_password
DATABASE_HOST=localhost
DATABASE_PORT=5432
REDIS_PASSWORD=your_redis_password
SUPERUSER_NAME=admin
SUPERUSER_EMAIL=admin@example.com
SUPERUSER_PASSWORD=your_admin_password
```

### éšæ®µ 3: åŸ·è¡Œè‡ªå‹•éƒ¨ç½² (30åˆ†é˜)

#### 3.1 åŸ·è¡Œéƒ¨ç½²è…³æœ¬
```bash
# åŸ·è¡Œå®Œæ•´éƒ¨ç½²è…³æœ¬
sudo ./å…¨æ–°éƒ¨ç½².sh
```

#### 3.2 éƒ¨ç½²éç¨‹èªªæ˜
è…³æœ¬æœƒè‡ªå‹•åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š

1. **ç³»çµ±å¥—ä»¶å®‰è£**
   - Python 3.10+ åŠç›¸é—œå¥—ä»¶
   - PostgreSQL è³‡æ–™åº«
   - Redis å¿«å–æœå‹™
   - Nginx Web ä¼ºæœå™¨

2. **ç³»çµ±ç”¨æˆ¶å»ºç«‹**
   - å»ºç«‹ `mes` ç”¨æˆ¶
   - è¨­å®šé©ç•¶çš„æ¬Šé™

3. **è³‡æ–™åº«é…ç½®**
   - å»ºç«‹è³‡æ–™åº«å’Œç”¨æˆ¶
   - è¨­å®šè³‡æ–™åº«æ¬Šé™

4. **å°ˆæ¡ˆéƒ¨ç½²**
   - è¤‡è£½å°ˆæ¡ˆæª”æ¡ˆ
   - å®‰è£ Python å¥—ä»¶
   - åˆå§‹åŒ–è³‡æ–™åº«

5. **æœå‹™é…ç½®**
   - å»ºç«‹ Systemd æœå‹™
   - é…ç½® Nginx
   - å•Ÿå‹•æ‰€æœ‰æœå‹™

#### 3.3 éƒ¨ç½²éç¨‹ç›£æ§
```bash
# æŸ¥çœ‹éƒ¨ç½²æ—¥èªŒ
tail -f /var/log/mes/deploy.log

# æŸ¥çœ‹å³æ™‚ç‹€æ…‹
sudo systemctl status mes.service
sudo systemctl status nginx
```

### éšæ®µ 4: é©—è­‰éƒ¨ç½² (5åˆ†é˜)

#### 4.1 æª¢æŸ¥æœå‹™ç‹€æ…‹
```bash
# æª¢æŸ¥æ‰€æœ‰æœå‹™ç‹€æ…‹
sudo systemctl status mes.service
sudo systemctl status mes-celery.service
sudo systemctl status celery-beat.service
sudo systemctl status nginx
sudo systemctl status postgresql
sudo systemctl status redis-server
```

#### 4.2 æ¸¬è©¦ç¶²ç«™è¨ªå•
```bash
# æ¸¬è©¦æœ¬åœ°è¨ªå•
curl -I http://localhost

# æ¸¬è©¦å¤–éƒ¨è¨ªå•
curl -I http://192.168.1.28

# æ¸¬è©¦ç®¡ç†å¾Œå°
curl -I http://192.168.1.28/admin
```

#### 4.3 æª¢æŸ¥è³‡æ–™åº«
```bash
# æª¢æŸ¥è³‡æ–™åº«é€£æ¥
sudo -u mes python3 manage.py dbshell -c "\dt"

# æª¢æŸ¥é·ç§»ç‹€æ…‹
sudo -u mes python3 manage.py showmigrations
```

---

## âœ… é©—è­‰éƒ¨ç½²

### ğŸ¯ æˆåŠŸæŒ‡æ¨™
éƒ¨ç½²æˆåŠŸå¾Œï¼Œæ‡‰è©²çœ‹åˆ°ä»¥ä¸‹çµæœï¼š

#### 1. æœå‹™ç‹€æ…‹
```bash
# æ‰€æœ‰æœå‹™éƒ½æ‡‰è©²é¡¯ç¤º "active (running)"
â— mes.service - MES Gunicorn daemon
   Loaded: loaded (/etc/systemd/system/mes.service; enabled)
   Active: active (running)

â— nginx.service - A high performance web server
   Loaded: loaded (/lib/systemd/system/nginx.service; enabled)
   Active: active (running)
```

#### 2. ç¶²ç«™è¨ªå•
- ç€è¦½å™¨è¨ªå• `http://192.168.1.28` æ‡‰è©²çœ‹åˆ° MES ç³»çµ±é¦–é 
- è¨ªå• `http://192.168.1.28/admin` æ‡‰è©²çœ‹åˆ° Django ç®¡ç†å¾Œå°

#### 3. è³‡æ–™åº«ç‹€æ…‹
```bash
# æ‡‰è©²çœ‹åˆ°å¤šå€‹è³‡æ–™è¡¨
sudo -u mes python3 manage.py dbshell -c "\dt"
```

### ğŸ” é©—è­‰æ¸…å–®
- [ ] æ‰€æœ‰ç³»çµ±æœå‹™é‹è¡Œæ­£å¸¸
- [ ] ç¶²ç«™å¯ä»¥æ­£å¸¸è¨ªå•
- [ ] ç®¡ç†å¾Œå°å¯ä»¥ç™»å…¥
- [ ] è³‡æ–™åº«é€£æ¥æ­£å¸¸
- [ ] æ—¥èªŒæª”æ¡ˆæ­£å¸¸ç”Ÿæˆ
- [ ] éœæ…‹æª”æ¡ˆæ­£ç¢ºè¼‰å…¥

---

## ğŸ”§ æ•…éšœæ’é™¤

### âŒ å¸¸è¦‹å•é¡Œ

#### 1. éƒ¨ç½²è…³æœ¬åŸ·è¡Œå¤±æ•—
**ç—‡ç‹€**: è…³æœ¬ä¸­é€”åœæ­¢æˆ–å ±éŒ¯
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥æ—¥èªŒ
tail -f /var/log/mes/deploy.log

# é‡æ–°åŸ·è¡Œ
sudo ./å…¨æ–°éƒ¨ç½².sh
```

#### 2. è³‡æ–™åº«é€£æ¥å¤±æ•—
**ç—‡ç‹€**: `connection to database failed`
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥ PostgreSQL æœå‹™
sudo systemctl status postgresql

# æª¢æŸ¥è³‡æ–™åº«é…ç½®
sudo -u postgres psql -c "\l"

# é‡æ–°é…ç½®è³‡æ–™åº«
sudo ./è³‡æ–™åº«åˆå§‹åŒ–.sh
```

#### 3. ç¶²ç«™ç„¡æ³•è¨ªå•
**ç—‡ç‹€**: ç€è¦½å™¨é¡¯ç¤ºé€£æ¥éŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥ Nginx æœå‹™
sudo systemctl status nginx

# æª¢æŸ¥ç«¯å£
sudo netstat -tlnp | grep :80

# æª¢æŸ¥é˜²ç«ç‰†
sudo ufw status
```

#### 4. æ¬Šé™å•é¡Œ
**ç—‡ç‹€**: `Permission denied` éŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ä¿®å¾©æ¬Šé™
sudo chown -R mes:www-data /var/www/mes/
sudo chown -R mes:www-data /var/log/mes/
sudo chmod -R 755 /var/www/mes/
```

### ğŸ“ ç·Šæ€¥ä¿®å¾©
å¦‚æœç³»çµ±å®Œå…¨ç„¡æ³•é‹è¡Œï¼ŒåŸ·è¡Œç·Šæ€¥ä¿®å¾©ï¼š
```bash
# åœæ­¢æ‰€æœ‰æœå‹™
sudo systemctl stop mes.service mes-celery.service celery-beat.service nginx

# æ¸…ç†ä¸¦é‡æ–°éƒ¨ç½²
sudo rm -rf /var/www/mes/*
sudo ./å…¨æ–°éƒ¨ç½².sh
```

---

## ğŸ› ï¸ ç¶­è­·æŒ‡å—

### ğŸ“Š æ—¥å¸¸ç¶­è­·

#### 1. æœå‹™ç›£æ§
```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
sudo systemctl status mes.service nginx postgresql redis-server

# æŸ¥çœ‹ç³»çµ±è³‡æº
htop
df -h
free -h
```

#### 2. æ—¥èªŒæª¢æŸ¥
```bash
# æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
tail -f /var/log/mes/django/mes.log

# æŸ¥çœ‹ Nginx æ—¥èªŒ
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# æŸ¥çœ‹ç³»çµ±æ—¥èªŒ
journalctl -u mes.service -f
```

#### 3. å‚™ä»½è³‡æ–™åº«
```bash
# å»ºç«‹è³‡æ–™åº«å‚™ä»½
sudo -u mes python3 manage.py dumpdata > backup_$(date +%Y%m%d_%H%M%S).json

# æˆ–ä½¿ç”¨ PostgreSQL å·¥å…·
sudo -u postgres pg_dump mesdb > backup_$(date +%Y%m%d_%H%M%S).sql
```

### ğŸ”„ ç³»çµ±æ›´æ–°

#### 1. æ›´æ–°ç³»çµ±å¥—ä»¶
```bash
sudo apt update && sudo apt upgrade -y
```

#### 2. é‡å•Ÿæœå‹™
```bash
sudo systemctl restart mes.service nginx postgresql redis-server
```

#### 3. æª¢æŸ¥æ›´æ–°å¾Œç‹€æ…‹
```bash
sudo systemctl status mes.service nginx postgresql redis-server
```

### ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

#### 1. è³‡æ–™åº«å„ªåŒ–
```bash
# åˆ†æè³‡æ–™åº«æ•ˆèƒ½
sudo -u postgres psql -d mesdb -c "ANALYZE;"

# æ¸…ç†èˆŠè³‡æ–™
sudo -u mes python3 manage.py clearsessions
```

#### 2. å¿«å–æ¸…ç†
```bash
# æ¸…ç† Redis å¿«å–
redis-cli -a your_redis_password FLUSHALL
```

#### 3. æ—¥èªŒæ¸…ç†
```bash
# æ¸…ç†èˆŠæ—¥èªŒ
sudo find /var/log/mes -name "*.log" -mtime +30 -delete
sudo find /var/log/nginx -name "*.log" -mtime +30 -delete
```

---

## ğŸ“ æŠ€è¡“æ”¯æ´

### ğŸ†˜ ç·Šæ€¥è¯çµ¡
- **ç³»çµ±ç®¡ç†å“¡**: [è¯çµ¡è³‡è¨Š]
- **æŠ€è¡“æ”¯æ´**: [è¯çµ¡è³‡è¨Š]
- **ç·Šæ€¥é›»è©±**: [é›»è©±è™Ÿç¢¼]

### ğŸ“š ç›¸é—œæ–‡ä»¶
- [MES ç³»çµ±ä½¿ç”¨æ‰‹å†Š]
- [API æ–‡ä»¶]
- [é–‹ç™¼è€…æ–‡ä»¶]

### ğŸ”— æœ‰ç”¨é€£çµ
- [Django å®˜æ–¹æ–‡ä»¶](https://docs.djangoproject.com/)
- [PostgreSQL æ–‡ä»¶](https://www.postgresql.org/docs/)
- [Nginx æ–‡ä»¶](https://nginx.org/en/docs/)

---

## ğŸ“ ç‰ˆæœ¬è³‡è¨Š

- **æ–‡ä»¶ç‰ˆæœ¬**: 1.0
- **æœ€å¾Œæ›´æ–°**: 2025-08-27
- **é©ç”¨ç‰ˆæœ¬**: MES ç³»çµ± v1.0
- **ä½œè€…**: MES é–‹ç™¼åœ˜éšŠ

---

**æ³¨æ„**: æœ¬æ–‡ä»¶é©ç”¨æ–¼ MES ç³»çµ±çš„å…¨æ–°ç”Ÿç”¢ä¸»æ©Ÿéƒ¨ç½²ã€‚å¦‚æœ‰ç–‘å•ï¼Œè«‹è¯çµ¡æŠ€è¡“æ”¯æ´åœ˜éšŠã€‚
