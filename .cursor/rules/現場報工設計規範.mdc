---
description:
globs:
alwaysApply: false
---

1. 現場報工主要功能
以當下報工狀態為時間戳
開工 為開始時間 暫停 為時間結束 一筆紀錄
重啟開工 為新的一筆紀錄開始 完工 為這筆紀錄真正的結束

2. 現場報工結構

資料庫資料表 workorder_onsite_report， workorder_onsite_report_session， workorder_onsite_report_history， workorder_onsite_report_config
一個模型
四個獨立的填報模板

3. 前端模板 
四個獨立的填報模板
作業員現場報工
作業員RD樣品現場報工
SMT現場報工
SMT_RD樣品現場報工
模板欄位格式依序要有
基本資訊欄位
產品編號 工單號碼 公司名稱
作業員 工序 使用的設備(可選) 都要是下拉式選單功能

數量資訊欄位
工單預設生產數量選擇工單自動填入
只有暫停 完工 停工 的時候才能填工作數量 不良品數量

狀態勾選欄
開工 暫停 重啟開工 完工 停工 只能單選

備註資訊欄位
備註 異常記錄


4. 模板功能設定 新增作業員填報紀錄跟新增SMT填報紀錄需有
4-1. 雙向關聯 產品編號←→工單號碼 工單號碼 → 公司名稱 三個欄位必須保留下拉式選單功能 工單號碼自動填入工單預設生產數量 使用統一的 JavaScript 模組 work_common.js
4-2. 作業員，工序，使用的設備 下拉式選單功能 使用統一的 JavaScript 模組 work_common.js
4-3. 新增作業員現場報工紀錄的工序跟設備不要顯示有 "SMT" 的字串
4-4. 新增SMT現場報工紀錄的工序跟設備不要顯示沒有 "SMT" 的字串，同時選擇設備的時候作業員欄位要自動也選擇同樣的設備名稱
4-5. 新增作業員RD樣品現場報工紀錄的產品編號預先填入 "PFP-CCT" 字串 工單號碼固定號碼為 "RD樣品" 工序與設備要過濾沒有 "SMT" 的字串
4-6. 新增SMT_RD樣品現場報工紀錄的產品編號預先填入 "PFP-CCT" 字串 工單號碼固定號碼為 "RD樣品" 工序與設備要過濾沒有 "SMT" 的字串

5. 現場報工要有能 報工工單裡沒有的工序的時候能自動加入工序到工單裡

## 統一API端點規範

## API路徑
所有工單相關API統一使用 `/var/www/mes/workorder/static/api/` 路徑

### 統一JS模組配置
```javascript
apiPrefix: '/var/www/mes/workorder/static/js/work_common.js'
```

###統一資料來源###
workorder_workorder

### 實作要求
1. 所有新功能必須使用統一API端點
2. 現有功能逐步遷移到統一API
3. 禁止使用其他API路徑

###唯一性要求###
company_name + workorder + product_id + operation + operator + work_date + start_time