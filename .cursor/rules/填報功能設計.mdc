---
description:
globs:
alwaysApply: false
---
1. 工單管理是主模組 填報管理是工單管理的次模組 SMT填報是填報管理的次模組 SMT現場填報跟SMT補登填報是SMT填報的次模組。
2. 工單管理是主模組 填報管理是工單管理的次模組 作業員填報是填報管理的次模組 作業員現場填報跟作業員補登填報是作業員填報的次模組。
SMT填報為SMT產線專用的填報模組，工序跟設備都只能跟SMT有關
時間格式不能有上午跟下午這種現代化的格式 填報人員看不懂這種格式
在原有的JS功能下不變的狀態下，產品編號變成手動輸入，工單號碼固定 RD樣品，工單預設生產數量預設是0的JS語法，不準修改原有JS語法功能。

3. 靜止變更作業員填報跟SMT填報資料表欄位 必須保持一致 依照作業員填報資料表為主要
資料表 所以填報資料表都必須跟作業員填報資料表一樣不能多不能少 
工單號碼 產品編號 公司名稱 API 來源為 WorkOrderDispatch 不檢查狀態
填報結構:
一個資料庫資料表
一個模型
四個獨立的填報模板

4. 填報共用資料表名稱: FillWork
資料表欄位格式
基本資訊欄位
operator - 作業員（CharField，純文字輸入）
company_name - 公司名稱（CharField）
工單相關欄位
workorder - 工單號碼（CharField）
product_id - 產品編號（CharField）
planned_quantity - 工單預設生產數量（IntegerField）
製程相關欄位
process - 工序（ForeignKey 到 ProcessName）
operation - 工序名稱
equipment - 使用的設備(可選)（CharField）
時間相關欄位
work_date - 工作日期（DateField）
start_time - 開始時間（TimeField）
end_time - 結束時間（TimeField）
休息時間相關欄位
has_break - 是否有休息時間（BooleanField）
break_start_time - 休息開始時間（TimeField）
break_end_time - 休息結束時間（TimeField）
break_hours - 休息時數（DecimalField）
工時計算欄位
work_hours_calculated - 工作時數（DecimalField）
overtime_hours_calculated - 加班時數（DecimalField）
數量相關欄位
work_quantity - 工作數量（IntegerField）
defect_quantity - 不良品數量（IntegerField）
狀態欄位
is_completed - 是否已完工（BooleanField）
核准相關欄位
approval_status - 核准狀態（CharField）
approved_by - 核准人員（CharField）
approved_at - 核准時間（DateTimeField）
approval_remarks - 核准備註（TextField）
駁回相關欄位
rejection_reason - 駁回原因（TextField）
rejected_by - 駁回人員（CharField）
rejected_at - 駁回時間（DateTimeField）
備註欄位
remarks - 備註（TextField）
abnormal_notes - 異常記錄（TextField）
系統欄位
created_by - 建立人員（CharField）
created_at - 建立時間（DateTimeField）
updated_at - 更新時間（DateTimeField）

所有填報都是正式填報作業
禁止添加 work_type 

然後建立四張模板跟4張表單
四張模板名稱分別為
作業員補登填報
作業員RD樣品補登填報
SMT補登填報
SMT_RD樣品補登填報

表單格式依序要有
基本資訊欄位
產品編號 工單號碼 公司名稱
作業員 工序 使用的設備(可選) 都要是下拉式選單功能

數量資訊欄位
工單預設生產數量 工作數量 不良品數量
是否已完工

時間日期欄位
填報日期 開始時間 結束時間

備註資訊欄位
備註 異常記錄

特殊設計欄位：
work_date - 填報日期
類型：DateField
特殊設計：
HTML5 date picker
新增時預設為今天日期

start_time - 開始時間
類型：TimeField（自定義）
特殊設計：
支援手動輸入（HH:MM格式）或是HH下拉是選單 MM下拉是選單
自動驗證時間格式
24小時制

end_time - 結束時間
類型：TimeField（自定義）
特殊設計：同 start_time

是否已完工 (勾選欄位)

功能設定 新增作業員填報紀錄跟新增SMT填報紀錄需有
1. 雙向關聯 產品編號←→工單號碼 工單號碼 → 公司名稱 三個欄位必須保留下拉式選單功能 工單號碼自動填入工單預設生產數量 使用統一的 JavaScript 模組 fill_work_common.js
2. 作業員，工序，使用的設備 下拉式選單功能 使用統一的 JavaScript 模組 fill_work_common.js
3. 新增作業員填報紀錄的工序跟設備要過濾有 "SMT" 的字串
4. 新增SMT填報紀錄的工序跟設備要過濾非 "SMT" 的字串，同時選擇設備的時候作業員欄位要自動也選擇同樣的設備名稱
5. 新增作業員RD樣品填報紀錄的產品編號預先填入 "PFP-CCT" 字串 工單號碼固定號碼為 "RD樣品" 工序與設備要過濾沒有 "SMT" 的字串
6. 新增SMT_RD樣品填報紀錄的產品編號預先填入 "PFP-CCT" 字串 工單號碼固定號碼為 "RD樣品" 工序與設備要過濾沒有 "SMT" 的字串
7. 新增作業員填報紀錄與新增作業員RD樣品填報紀錄中午有休息時間 12:00 ~ 13:00 計算工時要排除中午休息時間 然後17:30以後到20:30屬於加班時間
8. 新增SMT填報紀錄與新增SMT_RD樣品填報紀錄中午沒有休息時間直接將中午休息時間設定成 12:00 ~ 12:00 然後16:30以後到20:30屬於加班時間



模板排序
填報管理首頁 三個卡片 作業員填報 SMT填報 主管審核
 作業員填報作業首頁 三個卡片 新增作業員填報紀錄 新增作業員RD樣品填報紀錄 作業員填報資料維護
 SMT填報作業首頁 三個卡片 新增SMT填報紀錄 新增SMT_RD樣品填報紀錄 SMT填報資料維護
 主管審核首頁 三個卡片 待審核填報 已審核填報作業 填報功能設定

## API路徑
所有工單相關API統一使用 `/var/www/mes/workorder/static/api/` 路徑

### 統一JS模組配置
```javascript
apiPrefix: '/var/www/mes/workorder/static/js/fill_work_common.js'
```

###統一資料來源###
WorkOrderDispatch

### 實作要求
1. 所有新功能必須使用統一API端點
2. 現有功能逐步遷移到統一API
3. 禁止使用其他API路徑