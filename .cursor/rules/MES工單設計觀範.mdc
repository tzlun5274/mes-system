---
description:
globs:
alwaysApply: false
---

工單管理是主模組下面有多個子模組。主模組下面有多個子模組。
1. 基本設定。
-有多家公司，並會有重複的製令單號跟產品編號，設計須考慮多公司架構。

2. 唯一性識別：工單的唯一識別應該是 公司代號 + 工單號碼 + 產品編號。
查詢邏輯：所有涉及工單的查詢都必須同時考慮公司代號和工單號碼跟產品編號。
資料隔離：不同公司的資料應該完全隔離。

3.子模組分類 
公司製令單子模組
目錄名稱 company_order
✅ workorder_company_order - 公司製令單主表
✅ workorder_company_order_systemconfig - 系統設定表（製令單同步跟工單轉換相關）

派工單子模組
目錄名稱 dispatch
✅ workorder_dispatch - 派工單主表
✅ workorder_dispatch_process - 派工單工序明細
✅ workorder_dispatch_history - 派工歷史記錄

填報作業子模組
目錄名稱 fill_work
✅ workorder_fill_work - 填報作業主表

已完工工單子模組
目錄名稱 completed_workorder
✅ workorder_completed_workorder - 已完工工單主表
✅ workorder_completed_workorder_process - 已完工工單 工序&填報 明細
✅ workorder_completed_workorder_production_report - 已完工生產報表
✅ workorder_auto_allocation_settings - 自動分配設定
✅ workorder_auto_allocation_log - 自動分配日誌

現場報工子模組
目錄名稱 onsite_report
✅ workorder_onsite_report - 現場報工記錄主表
✅ workorder_onsite_report_session - 現場報工工作時段
✅ workorder_onsite_report_history - 現場報工歷史記錄
✅ workorder_onsite_report_config - 現場報工配置

生產監控子模組
目錄名稱 production_monitor
✅ workorder_production_monitor - 生產監控主表
✅ workorder_workorder_production_work_detail - 生產工作明細

 主模組其他資料表
✅ workorder_workorder - 工單主表（統一資料來源）
✅ workorder_workorderprocess - 工單工序明細
✅ workorder_workorderprocesslog - 工單工序日誌
✅ workorder_workorderoperation - 工單作業明細
✅ workorder_workorderoperationhistory - 工單作業歷史
✅ workorder_auto_management_config - 自動管理配置
✅ workorder_consistency_check_result - 一致性檢查結果

每個功能都是獨立的子模組。

4. 生產監控的工序紀錄來源為現場報工資料，填報紀錄來源為填報管理。
4-1. 派工單的工序與現場報工做關聯，工單詳情的工序紀錄與現場報工關聯。
4-2. 工單詳情的填報紀錄與填報管理做關聯。 
4-3. 工單詳情的完工判斷 以工序紀錄跟填報紀錄做合併計算

###統一資料來源####
workorder_workorder

## 統一API端點規範

### API路徑
所有工單相關API統一使用 `/var/www/mes/workorder/static/api/` 路徑

### 統一JS模組配置
```javascript
apiPrefix: '/var/www/mes/workorder/static/js/work_common.js'
```

首頁為七大卡片 
工單作業 公司製令單 派工單 
填報作業 現場報工作業 生產監控
已完工工單

下面三個系統維護功能
相符性檢查 清除所有工單 匯入工單