<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ¯å…¥åŠŸèƒ½æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>ğŸ” åŒ¯å…¥åŠŸèƒ½æ¸¬è©¦é é¢</h1>
        
        <div class="alert alert-info">
            <h5>æ¸¬è©¦æ­¥é©Ÿï¼š</h5>
            <ol>
                <li>é¸æ“‡ CSV æª”æ¡ˆ</li>
                <li>é»æ“Šã€Œæ¸¬è©¦åŒ¯å…¥ã€æŒ‰éˆ•</li>
                <li>æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°å’Œç¶²è·¯è«‹æ±‚</li>
            </ol>
        </div>
        
        <form method="post" enctype="multipart/form-data" action="{% url 'system:user_import' %}" id="testForm">
            {% csrf_token %}
            <div class="mb-3">
                <label for="testFile" class="form-label">é¸æ“‡æ¸¬è©¦æª”æ¡ˆ</label>
                <input type="file" class="form-control" id="testFile" name="file" accept=".csv,.xlsx" required>
                <div class="form-text">æ”¯æ´ CSVã€Excel æ ¼å¼æª”æ¡ˆ</div>
            </div>
            <button type="submit" class="btn btn-primary" id="testBtn">
                <i class="fas fa-upload me-1"></i>æ¸¬è©¦åŒ¯å…¥
            </button>
        </form>
        
        <div class="mt-4">
            <h5>ğŸ“‹ æ¸¬è©¦æª”æ¡ˆæ ¼å¼ï¼š</h5>
            <pre><code>username,email,password
testuser1,test1@example.com,123456
testuser2,test2@example.com,password123</code></pre>
        </div>
        
        <div class="mt-4">
            <h5>ğŸ” èª¿è©¦ä¿¡æ¯ï¼š</h5>
            <div id="debugInfo" class="alert alert-secondary">
                <p>ç­‰å¾…æ¸¬è©¦...</p>
            </div>
        </div>
    </div>

    <script>
        // è©³ç´°çš„èª¿è©¦ä¿¡æ¯
        const form = document.getElementById('testForm');
        const fileInput = document.getElementById('testFile');
        const debugInfo = document.getElementById('debugInfo');
        const testBtn = document.getElementById('testBtn');
        
        // æª”æ¡ˆé¸æ“‡äº‹ä»¶
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                debugInfo.innerHTML = `
                    <h6>ğŸ“ æª”æ¡ˆä¿¡æ¯ï¼š</h6>
                    <ul>
                        <li>æª”æ¡ˆåç¨±: ${file.name}</li>
                        <li>æª”æ¡ˆå¤§å°: ${(file.size / 1024).toFixed(2)} KB</li>
                        <li>æª”æ¡ˆé¡å‹: ${file.type}</li>
                        <li>æœ€å¾Œä¿®æ”¹: ${new Date(file.lastModified).toLocaleString()}</li>
                    </ul>
                `;
                console.log('ğŸ“ æª”æ¡ˆé¸æ“‡:', file);
            }
        });
        
        // è¡¨å–®æäº¤äº‹ä»¶
        form.addEventListener('submit', function(e) {
            console.log('ğŸš€ è¡¨å–®æäº¤é–‹å§‹');
            debugInfo.innerHTML += '<p>ğŸš€ è¡¨å–®æäº¤é–‹å§‹...</p>';
            
            const file = fileInput.files[0];
            if (!file) {
                e.preventDefault();
                alert('è«‹é¸æ“‡æª”æ¡ˆï¼');
                return false;
            }
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            testBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>åŒ¯å…¥ä¸­...';
            testBtn.disabled = true;
            
            debugInfo.innerHTML += '<p>ğŸ“¤ æ­£åœ¨æäº¤åˆ°ä¼ºæœå™¨...</p>';
            console.log('ğŸ“¤ æäº¤åˆ°:', form.action);
            console.log('ğŸ“¤ æ–¹æ³•:', form.method);
            console.log('ğŸ“¤ æª”æ¡ˆ:', file);
            
            // ç›£è½ç¶²è·¯è«‹æ±‚
            const startTime = Date.now();
            debugInfo.innerHTML += '<p>â±ï¸ é–‹å§‹è¨ˆæ™‚...</p>';
            
            // 10ç§’å¾Œæ¢å¾©æŒ‰éˆ•
            setTimeout(() => {
                testBtn.innerHTML = '<i class="fas fa-upload me-1"></i>æ¸¬è©¦åŒ¯å…¥';
                testBtn.disabled = false;
                debugInfo.innerHTML += '<p>â° 10ç§’è¶…æ™‚ï¼ŒæŒ‰éˆ•å·²æ¢å¾©</p>';
            }, 10000);
        });
        
        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ');
            debugInfo.innerHTML = '<p>âœ… æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆï¼Œè«‹é¸æ“‡æª”æ¡ˆé€²è¡Œæ¸¬è©¦</p>';
        });
    </script>
</body>
</html>
